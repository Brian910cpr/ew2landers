<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>910CPR – Class Schedule</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Live CPR and medical training schedule for Wilmington, Burgaw, Jacksonville / Camp Lejeune, and Southeastern NC. See real dates, times, locations, and book your seat.">
  <style>
    :root {
      --bg-top: #ffffff;
      --bg-bottom: #e9f5ff;
      --card-bg: #ffffff;
      --card-border: #d2e4f5;
      --accent: #0b63ce;
      --accent-soft: #e2efff;
      --accent-danger: #b00020;
      --text-main: #123047;
      --text-muted: #60748a;
      --radius-lg: 18px;
      --shadow-soft: 0 8px 20px rgba(0,0,0,0.06);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(to bottom, var(--bg-top), var(--bg-bottom));
      color: var(--text-main);
    }

    .page-wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 16px 16px 40px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-logo {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #0077ff);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 18px;
      color: #ffffff;
      box-shadow: var(--shadow-soft);
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      line-height: 1.1;
    }

    .brand-text span:first-child {
      font-weight: 700;
      font-size: 18px;
    }

    .brand-text span:last-child {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .nav-links a {
      font-size: 13px;
      text-decoration: none;
      color: var(--accent);
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(11, 99, 206, 0.08);
      white-space: nowrap;
    }

    .hero {
      margin-top: 6px;
      margin-bottom: 16px;
      padding: 16px 18px;
      background: linear-gradient(120deg,#e8f3ff,#ffffff);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-soft);
      display: grid;
      grid-template-columns: minmax(0,2.3fr) minmax(0,1.7fr);
      gap: 16px;
    }

    @media (max-width: 768px) {
      .hero {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .hero h1 {
      margin: 0 0 8px;
      font-size: 22px;
    }

    .hero p {
      margin: 0;
      font-size: 13px;
      color: var(--text-muted);
    }

    .hero-highlight {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      background: rgba(11,99,206,0.06);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .hero-highlight span:first-child {
      font-size: 16px;
    }

    .hero-side {
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .hero-side strong {
      color: var(--text-main);
      font-size: 13px;
    }

    .filters {
      margin-bottom: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .filters-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .filters-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    select {
      min-width: 150px;
      padding: 6px 9px;
      border-radius: 999px;
      border: 1px solid #c4d7eb;
      font-size: 12px;
      background: #ffffff;
      color: var(--text-main);
    }

    .pill-button {
      border: none;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      background: #ffffff;
      border: 1px solid #c4d7eb;
      color: var(--text-main);
    }

    .pill-button.primary {
      background: var(--accent);
      border-color: var(--accent);
      color: #ffffff;
    }

    .pill-button:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .schedule-status {
      margin-bottom: 10px;
      font-size: 12px;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: baseline;
    }

    .schedule-status strong {
      color: var(--text-main);
    }

    .banner-error {
      border-radius: var(--radius-lg);
      background: #ffe4e8;
      color: var(--accent-danger);
      padding: 10px 12px;
      font-size: 12px;
      margin-bottom: 16px;
    }

    .class-list {
      display: grid;
      grid-template-columns: minmax(0,1fr);
      gap: 10px;
    }

    .class-card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      box-shadow: var(--shadow-soft);
      padding: 12px 14px;
      display: grid;
      grid-template-columns: minmax(0,2.4fr) minmax(0,1.6fr);
      gap: 10px;
      align-items: center;
    }

    @media (max-width: 640px) {
      .class-card {
        grid-template-columns: minmax(0,1fr);
      }
    }

    .class-main {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .class-title {
      font-size: 14px;
      font-weight: 600;
    }

    .class-meta {
      font-size: 12px;
      color: var(--text-muted);
    }

    .class-meta strong {
      color: var(--text-main);
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .chip.past {
      background: #ffe4e8;
      color: var(--accent-danger);
    }

    .class-actions {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
      justify-content: center;
    }

    @media (max-width: 640px) {
      .class-actions {
        align-items: flex-start;
      }
    }

    .price {
      font-size: 13px;
      font-weight: 600;
    }

    .price span {
      font-size: 11px;
      color: var(--text-muted);
      font-weight: 400;
    }

    .button-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 7px 12px;
      font-size: 12px;
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .btn-primary {
      background: var(--accent);
      color: #ffffff;
    }

    .btn-secondary {
      background: #ffffff;
      color: var(--accent);
      border: 1px solid var(--accent-soft);
    }

    .btn-disabled {
      background: #f0f0f0;
      color: #999999;
      cursor: default;
    }

    .empty-state {
      margin-top: 12px;
      font-size: 13px;
      color: var(--text-muted);
      padding: 12px 14px;
      border-radius: var(--radius-lg);
      border: 1px dashed #c4d7eb;
      background: rgba(255,255,255,0.7);
    }

    footer {
      margin-top: 24px;
      font-size: 11px;
      color: var(--text-muted);
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="page-wrap">
    <header>
      <div class="brand">
        <div class="brand-logo">9</div>
        <div class="brand-text">
          <span>910CPR</span>
          <span>CPR & Medical Training</span>
        </div>
      </div>
      <div class="nav-links">
        <a href="https://910cpr.com/">Back to 910CPR.com</a>
      </div>
    </header>

    <section class="hero">
      <div>
        <h1>Live CPR & Medical Training Schedule</h1>
        <p>
          This page pulls directly from the latest Enrollware export (via <code>schedule.json</code>).
          Every refresh reads the new JSON, so if the JSON is up to date, this schedule is up to date.
        </p>
        <div class="hero-highlight">
          <span>⚡</span>
          <span>Students land here → see real dates, times, locations → tap one button to register.</span>
        </div>
      </div>
      <div class="hero-side">
        <strong>Did you need a different time?</strong>
        <span>
          Every class card includes a “See other times” button that jumps to the filtered course schedule
          (when available in the JSON).
        </span>
        <span>
          If a date is in the past, the main button switches to “Registration closed – see other times”
          automatically based on the class date.
        </span>
      </div>
    </section>

    <section class="filters">
      <div class="filters-group">
        <span class="filters-label">Filter by course:</span>
        <select id="filter-course">
          <option value="">All courses</option>
        </select>
      </div>
      <div class="filters-group">
        <span class="filters-label">Filter by area:</span>
        <select id="filter-location">
          <option value="">All locations</option>
        </select>
      </div>
      <button class="pill-button" id="clear-filters">Clear filters</button>
      <button class="pill-button primary" id="toggle-past">Hide past classes</button>
    </section>

    <div id="status" class="schedule-status">
      <span><strong>Loading schedule…</strong></span>
    </div>

    <div id="error" class="banner-error" style="display:none;"></div>

    <div id="class-list" class="class-list"></div>

    <div id="empty" class="empty-state" style="display:none;">
      No classes match your filters. Try clearing filters or check back after the next schedule.json update.
    </div>

    <footer>
      This page is powered by your Enrollware export → schedule.json → static HTML.
      If this page looks empty but you know you have classes, the problem is the JSON, not the page.
    </footer>
  </div>

  <script>
    // ==============================
    // CONFIG – ADJUST THIS FOR YOUR REPO
    // ==============================

    // Path where the built JSON lives, relative to this HTML file.
    // Example if your repo has docs/data/schedule.json and docs/schedule.html:
    //   "data/schedule.json"
    const SCHEDULE_URL = "data/schedule.json";

    // Field fallbacks for different JSON shapes.
    const FIELD_KEYS = {
      id: ["id", "class_id", "enrollware_id"],
      start: ["start_iso", "startDateTime", "start", "start_utc"],
      course: ["course_name", "title", "course"],
      location: ["location", "city_state", "city"],
      city: ["city", "city_state"],
      price: ["price", "student_price", "tuition"],
      seats: ["seats_left", "available_seats", "remaining_seats"],
      enrollUrl: ["enroll_url", "enrollUrl", "url", "register_url"],
      courseScheduleUrl: ["course_schedule_url", "courseScheduleUrl"]
    };

    // ==============================
    // HELPER FUNCTIONS
    // ==============================

    function pickField(obj, keys) {
      for (const k of keys) {
        if (Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null && obj[k] !== "") {
          return obj[k];
        }
      }
      return "";
    }

    function normalizeClass(raw) {
      const id = pickField(raw, FIELD_KEYS.id) || "";
      const startRaw = pickField(raw, FIELD_KEYS.start);
      const course = pickField(raw, FIELD_KEYS.course) || "Untitled course";
      const location = pickField(raw, FIELD_KEYS.location) || "";
      const city = pickField(raw, FIELD_KEYS.city) || "";
      const priceRaw = pickField(raw, FIELD_KEYS.price);
      const seatsRaw = pickField(raw, FIELD_KEYS.seats);
      const enrollUrl = pickField(raw, FIELD_KEYS.enrollUrl);
      const courseScheduleUrl = pickField(raw, FIELD_KEYS.courseScheduleUrl);

      const start = startRaw ? new Date(startRaw) : null;
      const now = new Date();
      const isPast = !!(start && start < now);

      let displayDate = "Date TBA";
      let displayTime = "";
      if (start && !isNaN(start.getTime())) {
        displayDate = start.toLocaleDateString("en-US", {
          weekday: "short",
          month: "short",
          day: "numeric",
          year: "numeric"
        });
        displayTime = start.toLocaleTimeString("en-US", {
          hour: "numeric",
          minute: "2-digit"
        });
      }

      let price = "";
      if (priceRaw || priceRaw === 0) {
        price = "$" + Number(priceRaw).toFixed(2).replace(/\.00$/, "");
      }

      let seats = "";
      if (seatsRaw || seatsRaw === 0) {
        const n = Number(seatsRaw);
        if (!isNaN(n)) {
          seats = n > 0 ? `${n} seat${n === 1 ? "" : "s"} left` : "No seats left";
        } else {
          seats = String(seatsRaw);
        }
      }

      return {
        raw,
        id,
        start,
        isPast,
        displayDate,
        displayTime,
        course,
        location,
        city,
        price,
        seats,
        enrollUrl,
        courseScheduleUrl
      };
    }

    function cmpByStartAsc(a, b) {
      if (!a.start && !b.start) return 0;
      if (!a.start) return 1;
      if (!b.start) return -1;
      return a.start - b.start;
    }

    // ==============================
    // RENDERING
    // ==============================

    const state = {
      all: [],
      showPast: true,
      filterCourse: "",
      filterLocation: ""
    };

    const dom = {
      status: document.getElementById("status"),
      error: document.getElementById("error"),
      list: document.getElementById("class-list"),
      empty: document.getElementById("empty"),
      filterCourse: document.getElementById("filter-course"),
      filterLocation: document.getElementById("filter-location"),
      clearFilters: document.getElementById("clear-filters"),
      togglePast: document.getElementById("toggle-past")
    };

    function setStatus(msg, extra) {
      dom.status.innerHTML = "";
      const span = document.createElement("span");
      span.textContent = msg;
      dom.status.appendChild(span);
      if (extra) {
        const extraSpan = document.createElement("span");
        extraSpan.textContent = " " + extra;
        dom.status.appendChild(extraSpan);
      }
    }

    function showError(msg) {
      dom.error.style.display = "block";
      dom.error.textContent = msg;
    }

    function hideError() {
      dom.error.style.display = "none";
      dom.error.textContent = "";
    }

    function buildFilters(classes) {
      const courses = new Set();
      const locations = new Set();

      for (const c of classes) {
        if (c.course) courses.add(c.course);
        if (c.city) locations.add(c.city);
      }

      const sortedCourses = Array.from(courses).sort();
      const sortedLocations = Array.from(locations).sort();

      dom.filterCourse.innerHTML = "<option value=\"\">All courses</option>";
      sortedCourses.forEach(course => {
        const opt = document.createElement("option");
        opt.value = course;
        opt.textContent = course;
        dom.filterCourse.appendChild(opt);
      });

      dom.filterLocation.innerHTML = "<option value=\"\">All locations</option>";
      sortedLocations.forEach(loc => {
        const opt = document.createElement("option");
        opt.value = loc;
        opt.textContent = loc;
        dom.filterLocation.appendChild(opt);
      });
    }

    function applyFilters() {
      const now = new Date();
      let filtered = state.all.slice();

      if (!state.showPast) {
        filtered = filtered.filter(c => !c.isPast);
      }
      if (state.filterCourse) {
        filtered = filtered.filter(c => c.course === state.filterCourse);
      }
      if (state.filterLocation) {
        filtered = filtered.filter(c => c.city === state.filterLocation);
      }

      filtered.sort(cmpByStartAsc);
      renderClassList(filtered);

      const total = state.all.length;
      const visible = filtered.length;
      const pastCount = state.all.filter(c => c.isPast).length;
      const futureCount = total - pastCount;
      setStatus(
        `Showing ${visible} of ${total} classes.`,
        `(Upcoming: ${futureCount}, Past: ${pastCount})`
      );
    }

    function renderClassList(list) {
      dom.list.innerHTML = "";
      if (list.length === 0) {
        dom.empty.style.display = "block";
        return;
      }
      dom.empty.style.display = "none";

      for (const c of list) {
        const card = document.createElement("article");
        card.className = "class-card";

        const main = document.createElement("div");
        main.className = "class-main";

        const title = document.createElement("div");
        title.className = "class-title";
        title.textContent = c.course;
        main.appendChild(title);

        const meta1 = document.createElement("div");
        meta1.className = "class-meta";
        meta1.innerHTML = `<strong>${c.displayDate}</strong>${c.displayTime ? " · " + c.displayTime : ""}`;
        main.appendChild(meta1);

        const metaRow = document.createElement("div");
        metaRow.className = "meta-row";

        if (c.location || c.city) {
          const loc = document.createElement("span");
          loc.className = "class-meta";
          const locText = [c.location, c.city].filter(Boolean).join(" · ");
          loc.textContent = locText;
          metaRow.appendChild(loc);
        }

        if (c.seats) {
          const chipSeats = document.createElement("span");
          chipSeats.className = "chip";
          chipSeats.textContent = c.seats;
          metaRow.appendChild(chipSeats);
        }

        const chipTime = document.createElement("span");
        chipTime.className = "chip" + (c.isPast ? " past" : "");
        chipTime.textContent = c.isPast ? "Past date" : "Open for registration";
        metaRow.appendChild(chipTime);

        main.appendChild(metaRow);
        card.appendChild(main);

        const actions = document.createElement("div");
        actions.className = "class-actions";

        const priceEl = document.createElement("div");
        priceEl.className = "price";
        if (c.price) {
          priceEl.innerHTML = `${c.price} <span>per student</span>`;
        } else {
          priceEl.innerHTML = `<span>Price shown on registration page</span>`;
        }
        actions.appendChild(priceEl);

        const btnRow = document.createElement("div");
        btnRow.className = "button-row";

        const mainBtn = document.createElement("a");
        mainBtn.className = "btn";
        mainBtn.target = "_blank";

        if (c.isPast) {
          mainBtn.classList.add("btn-secondary");
          mainBtn.textContent = "Registration closed – see other times";
          if (c.courseScheduleUrl) {
            mainBtn.href = c.courseScheduleUrl;
          } else if (c.enrollUrl) {
            // Fallback if you don't have a separate course schedule URL.
            mainBtn.href = c.enrollUrl;
          } else {
            mainBtn.classList.add("btn-disabled");
            mainBtn.href = "#";
          }
        } else {
          mainBtn.classList.add("btn-primary");
          mainBtn.textContent = "Register for this class";
          if (c.enrollUrl) {
            mainBtn.href = c.enrollUrl;
          } else if (c.courseScheduleUrl) {
            mainBtn.href = c.courseScheduleUrl;
          } else {
            mainBtn.classList.add("btn-disabled");
            mainBtn.href = "#";
          }
        }

        btnRow.appendChild(mainBtn);

        if (c.courseScheduleUrl) {
          const altBtn = document.createElement("a");
          altBtn.className = "btn btn-secondary";
          altBtn.textContent = "See other times for this course";
          altBtn.href = c.courseScheduleUrl;
          altBtn.target = "_blank";
          btnRow.appendChild(altBtn);
        }

        actions.appendChild(btnRow);
        card.appendChild(actions);

        dom.list.appendChild(card);
      }
    }

    // ==============================
    // EVENT WIRING
    // ==============================

    dom.filterCourse.addEventListener("change", () => {
      state.filterCourse = dom.filterCourse.value;
      applyFilters();
    });

    dom.filterLocation.addEventListener("change", () => {
      state.filterLocation = dom.filterLocation.value;
      applyFilters();
    });

    dom.clearFilters.addEventListener("click", () => {
      state.filterCourse = "";
      state.filterLocation = "";
      dom.filterCourse.value = "";
      dom.filterLocation.value = "";
      applyFilters();
    });

    dom.togglePast.addEventListener("click", () => {
      state.showPast = !state.showPast;
      dom.togglePast.textContent = state.showPast ? "Hide past classes" : "Show past classes";
      applyFilters();
    });

    // ==============================
    // INITIAL LOAD
    // ==============================

    (function init() {
      setStatus("Loading schedule…");
      hideError();

      fetch(SCHEDULE_URL, { cache: "no-store" })
        .then(resp => {
          if (!resp.ok) {
            throw new Error("HTTP " + resp.status + " loading schedule.json");
          }
          return resp.json();
        })
        .then(json => {
          if (!Array.isArray(json)) {
            throw new Error("schedule.json is not an array; adjust the loader or your export script.");
          }
          const normalized = json.map(normalizeClass);
          state.all = normalized;
          buildFilters(normalized);
          applyFilters();

          if (normalized.length === 0) {
            setStatus("Schedule loaded, but no classes were found in schedule.json.");
          } else {
            setStatus("Schedule loaded.", `(Total classes in JSON: ${normalized.length})`);
          }
        })
        .catch(err => {
          console.error(err);
          showError("Unable to load schedule.json. Check the SCHEDULE_URL in this file and confirm that your export script wrote a valid JSON array.");
          setStatus("Error loading schedule.");
        });
    })();
  </script>
</body>
</html>