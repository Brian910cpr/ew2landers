<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>910CPR – Live Class Schedule (Desktop)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Optional base CSS / theme hooks if they exist -->
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/themes.css">
  <script src="assets/js/theme-scheduler.js" defer></script>

  <style>
    :root {
      --bg-page: #f4f6fb;
      --bg-panel: #ffffff;
      --bg-panel-alt: #e5edf9;
      --border-subtle: rgba(148, 163, 184, 0.35);
      --border-strong: rgba(15, 23, 42, 0.18);
      --text-main: #0f172a;
      --text-muted: #6b7280;
      --accent-main: #2563eb;
      --accent-soft: rgba(37, 99, 235, 0.06);
      --accent-soft-strong: rgba(37, 99, 235, 0.12);
      --accent-border: rgba(37, 99, 235, 0.4);
      --shadow-soft: 0 14px 40px rgba(15, 23, 42, 0.13);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "SF Pro Display", "Segoe UI", Roboto, Arial, sans-serif;
      background: radial-gradient(circle at top left, #e0edff, #f5f7fb 38%, #e5f1ff 100%);
      color: var(--text-main);
    }

    .page-shell {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: clamp(12px, 2vw, 24px);
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: clamp(12px, 2vw, 20px);
    }

    .brand-block {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .brand-logo {
      width: clamp(72px, 12vw, 110px);
      height: auto;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.35);
      background: #0f172a;
      object-fit: cover;
    }

    .brand-text {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .brand-title {
      font-size: clamp(1.1rem, 1.2vw + 0.7rem, 1.4rem);
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .brand-subtitle {
      font-size: clamp(0.8rem, 0.9vw, 0.9rem);
      color: var(--text-muted);
      max-width: 480px;
    }

    .header-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .header-right strong {
      font-weight: 600;
      color: #111827;
    }

    .header-divider-row {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: clamp(8px, 1.5vw, 12px);
    }

    .header-divider {
      flex: 1;
      border-radius: 999px;
      overflow: hidden;
      background: linear-gradient(90deg, rgba(15, 23, 42, 0.5), rgba(15, 23, 42, 0.0));
      min-height: 1px;
      position: relative;
    }

    .header-divider img {
      display: block;
      width: 100%;
      height: auto;
      opacity: 0.75;
    }

    .header-corner {
      width: clamp(32px, 4vw, 40px);
      height: auto;
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.35);
      background: #020617;
    }

    .header-corner img {
      display: block;
      width: 100%;
      height: auto;
    }

    .page-grid {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(240px, 0.9fr) minmax(320px, 1.1fr) minmax(320px, 1.2fr);
      gap: clamp(12px, 1.6vw, 18px);
      align-items: stretch;
    }

    .panel {
      background: rgba(248, 250, 252, 0.95);
      border-radius: 24px;
      box-shadow: 0 18px 50px rgba(15, 23, 42, 0.16);
      border: 1px solid rgba(148, 163, 184, 0.22);
      padding: clamp(12px, 1.4vw, 16px);
      display: flex;
      flex-direction: column;
      min-height: 0;
      position: relative;
      overflow: hidden;
    }

    .panel::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top left, rgba(59, 130, 246, 0.08), transparent 50%);
      pointer-events: none;
    }

    .panel-inner {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .panel-header {
      margin-bottom: 10px;
    }

    .panel-title {
      font-size: clamp(0.92rem, 1vw, 1.02rem);
      font-weight: 650;
      letter-spacing: 0.01em;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .panel-subtitle {
      margin-top: 2px;
      font-size: clamp(0.75rem, 0.8vw, 0.82rem);
      color: var(--text-muted);
    }

    .panel-body {
      flex: 1;
      min-height: 0;
      overflow: auto;
      padding-right: 2px;
    }

    .panel-body::-webkit-scrollbar {
      width: 6px;
    }

    .panel-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .panel-body::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.5);
      border-radius: 999px;
    }

    .panel-body::-webkit-scrollbar-thumb:hover {
      background: rgba(148, 163, 184, 0.7);
    }

    .subtle-pill {
      padding: 3px 9px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.06);
      border: 1px solid rgba(148, 163, 184, 0.35);
      font-size: 0.7rem;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .subtle-pill strong {
      color: #111827;
      font-weight: 600;
    }

    .family-card {
      border-radius: 18px;
      padding: 8px 9px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      border: 1px solid transparent;
      background: rgba(248, 250, 252, 0.95);
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.05s ease,
        box-shadow 0.12s ease;
    }

    .family-card:hover {
      background: rgba(239, 246, 255, 0.9);
      border-color: rgba(37, 99, 235, 0.4);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }

    .family-card.selected {
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(59, 130, 246, 0.06));
      border-color: rgba(37, 99, 235, 0.65);
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.22);
    }

    .family-thumb {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      overflow: hidden;
      flex-shrink: 0;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .family-thumb img {
      display: block;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .family-main {
      flex: 1;
      min-width: 0;
    }

    .family-title {
      font-size: 0.9rem;
      font-weight: 630;
      margin-bottom: 2px;
    }

    .family-blurb {
      font-size: 0.75rem;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .course-card {
      border-radius: 16px;
      padding: 9px 10px;
      margin-bottom: 7px;
      border: 1px solid rgba(148, 163, 184, 0.3);
      background: rgba(248, 250, 252, 0.96);
      cursor: pointer;
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.05s ease,
        box-shadow 0.12s ease;
    }

    .course-card:hover {
      background: rgba(239, 246, 255, 0.96);
      border-color: rgba(37, 99, 235, 0.4);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.18);
      transform: translateY(-1px);
    }

    .course-card.selected {
      border-color: rgba(37, 99, 235, 0.75);
      box-shadow: 0 18px 38px rgba(15, 23, 42, 0.22);
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.11), rgba(248, 250, 252, 0.98));
    }

    .course-title-main {
      font-weight: 640;
      font-size: 0.9rem;
      margin-bottom: 2px;
    }

    .course-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 6px;
      margin-top: 2px;
    }

    .course-chip {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-main);
      font-weight: 500;
      white-space: nowrap;
    }

    .course-subtext {
      font-size: 11px;
      color: var(--text-muted);
    }

    .course-description {
      margin-top: 6px;
      font-size: 11px;
      line-height: 1.4;
      color: var(--text-muted);
    }

    .course-foot-row {
      font-size: 10px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    .course-foot-row .chevron {
      font-size: 12px;
      opacity: 0.65;
    }

    .course-mini-pill {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.03);
      border: 1px dashed rgba(148, 163, 184, 0.8);
      font-size: 10px;
      color: var(--text-muted);
    }

    .course-mini-pill strong {
      font-weight: 600;
      color: #111827;
    }

    .course-mini {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.03);
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: 10px;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .course-mini.selected {
      background: rgba(37, 99, 235, 0.09);
      color: #111827;
      border-color: rgba(37, 99, 235, 0.75);
    }

    .course-mini strong {
      font-weight: 650;
    }

    .course-mini span:nth-child(2) {
      opacity: 0.7;
    }

    .course-mini span:nth-child(3) {
      font-size: 9px;
      opacity: 0.7;
    }

    .course-mini-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.35);
    }

    .course-mini-count {
      font-size: 9px;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.03);
      color: var(--text-muted);
      border: 1px solid rgba(148, 163, 184, 0.7);
      margin-top: 3px;
      display: inline-flex;
      gap: 6px;
      align-items: center;
    }

    .course-mini-count strong {
      font-weight: 600;
      color: #111827;
    }

    .status-text {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding: 12px 6px;
    }

    .session-card {
      border-radius: 16px;
      padding: 8px 9px;
      margin-bottom: 7px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(248, 250, 252, 0.97);
      display: flex;
      flex-direction: column;
      gap: 3px;
      transition: background 0.12s ease, border-color 0.12s ease, transform 0.05s ease,
        box-shadow 0.12s ease;
    }

    .session-card:hover {
      background: rgba(239, 246, 255, 0.98);
      border-color: rgba(37, 99, 235, 0.5);
      box-shadow: 0 14px 32px rgba(15, 23, 42, 0.22);
      transform: translateY(-1px);
    }

    .session-main-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      font-size: 0.84rem;
      font-weight: 560;
    }

    .session-date {
      display: flex;
      flex-direction: column;
    }

    .session-date span:first-child {
      text-transform: uppercase;
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      color: var(--text-muted);
    }

    .session-date span:last-child {
      font-size: 0.83rem;
    }

    .session-location {
      font-size: 0.8rem;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .session-location-pill {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.04);
      border: 1px dashed rgba(148, 163, 184, 0.8);
    }

    .session-foot-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
      font-size: 10px;
    }

    .session-price {
      color: var(--text-muted);
      font-style: italic;
    }

    .session-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 0;
      background: var(--accent-main);
      color: white;
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      box-shadow: 0 10px 28px rgba(37, 99, 235, 0.55);
    }

    .session-btn span:last-child {
      font-size: 1rem;
      translate: 0 0;
      transition: transform 0.12s ease;
    }

    .session-btn:hover span:last-child {
      transform: translateX(2px);
    }

    .no-sessions {
      font-size: 0.8rem;
      color: var(--text-muted);
      padding: 12px 8px;
      border-radius: 12px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: rgba(248, 250, 252, 0.95);
    }

    .stacked-panels {
      display: grid;
      grid-template-rows: auto 1fr auto;
      min-height: 0;
    }

    .stack-header {
      margin-bottom: 6px;
    }

    .stack-body {
      flex: 1;
      min-height: 0;
      overflow: auto;
      padding-right: 2px;
    }

    .stack-body::-webkit-scrollbar {
      width: 6px;
    }

    .stack-body::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.4);
      border-radius: 999px;
    }

    .stack-footer {
      margin-top: 6px;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .nav-back {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.9);
      padding: 4px 10px;
      color: #e5e7eb;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.85);
      font-size: 0.75rem;
      font-weight: 500;
    }

    .nav-back span:last-child {
      opacity: 0.8;
    }

    .nav-back:hover {
      background: #020617;
    }

    .nav-back-arrow {
      width: 20px;
      height: 20px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(15, 23, 42, 0.95);
      font-size: 0.9rem;
    }

    .nav-back-label {
      text-transform: uppercase;
      letter-spacing: 0.12em;
      font-size: 0.65rem;
    }

    .nav-right-pill {
      font-size: 0.7rem;
      color: var(--text-muted);
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.02);
    }

    .panel-header-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .panel-header-titles {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .panel-header-title-large {
      font-size: 0.9rem;
      font-weight: 650;
    }

    .panel-header-sub {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .body-note-sm {
      font-size: 0.72rem;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .family-pill-badge {
      font-size: 0.7rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(248, 250, 252, 0.95);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
    }

    .family-pill-badge strong {
      font-weight: 600;
      color: #111827;
    }

    .nav-back-wide {
      display: flex;
      align-items: center;
      gap: 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: linear-gradient(180deg, #020617, #020617);
      padding: 4px 10px;
      color: #e5e7eb;
      cursor: pointer;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.85);
      font-size: 0.78rem;
      font-weight: 500;
      width: 100%;
      justify-content: space-between;
    }

    .nav-back-wide-main {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .nav-arrow-pill {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.95);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.88rem;
    }

    .nav-back-wide-labels {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .nav-back-wide-label-main {
      text-transform: uppercase;
      letter-spacing: 0.14em;
      font-size: 0.67rem;
    }

    .nav-back-wide-label-sub {
      font-size: 0.7rem;
      opacity: 0.85;
    }

    .nav-back-wide-right {
      font-size: 0.7rem;
      color: rgba(209, 213, 219, 0.9);
    }

    .nav-back-wide:hover {
      background: #020617;
    }

    .family-name-chip {
      font-size: 0.75rem;
      padding: 3px 7px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(248, 250, 252, 0.98);
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .family-name-chip strong {
      font-weight: 600;
      color: #111827;
    }

    .mini-status {
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .nav-arrow-button {
      width: 100%;
      height: 100%;
      border-radius: 22px 0 0 22px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: linear-gradient(180deg, #020617, #0f172a);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.65);
    }

    .nav-arrow-button:hover {
      background: #020617;
    }

    .nav-arrow-button span {
      display: block;
      transform: translateX(-1px);
    }

    @media (max-width: 1100px) {
      .page-grid {
        grid-template-columns: minmax(240px, 0.95fr) minmax(260px, 1.05fr);
        grid-template-rows: minmax(260px, 1.1fr) minmax(260px, 1.1fr);
      }

      .panel:nth-child(3) {
        grid-column: 1 / span 2;
      }
    }

    @media (max-width: 900px) {
      .page-shell {
        padding: 10px;
      }

      .page-grid {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
      }

      .panel:nth-child(2),
      .panel:nth-child(3) {
        min-height: 260px;
      }

      header {
        flex-direction: column;
        align-items: flex-start;
      }

      .header-right {
        align-items: flex-start;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      * {
        scroll-behavior: auto !important;
        animation-duration: 0s !important;
        transition-duration: 0s !important;
      }
    }
  </style>
</head>
<body>
  <div class="page-shell">
    <header>
      <div class="brand-block">
        <img id="themeLogo" class="brand-logo" src="assets/images/910CPR_wave.jpg" alt="910CPR logo">
        <div class="brand-text">
          <div class="brand-title">910CPR · Live CPR & First Aid Training</div>
          <div class="brand-subtitle">
            Scroll the schedule, choose your class family, and jump straight to Enrollware to register.
          </div>
        </div>
      </div>
      <div class="header-right">
        <div><strong>Questions?</strong> Call or text (910) 395-5193.</div>
        <div>Wilmington · Burgaw · Jacksonville · Onsite at your workplace.</div>
      </div>
    </header>

    <div class="header-divider-row">
      <div class="header-divider">
        <img id="themeDivider" src="assets/images/theme/default-divider.png" alt="Seasonal divider">
      </div>
      <div class="header-corner">
        <img id="themeCorner" src="assets/images/theme/default-corner.png" alt="Seasonal accent">
      </div>
    </div>

    <main class="page-grid">
      <!-- Left: Families -->
      <section class="panel">
        <div class="panel-inner">
          <div class="panel-header">
            <div class="panel-title">
              Step 1: Choose a class family
            </div>
            <div class="panel-subtitle">
              Healthcare, ACLS/PALS, CPR/AED, First Aid, Instructor, and more.
            </div>
          </div>
          <div class="panel-body" id="familyList">
            <!-- Family cards injected here -->
          </div>
        </div>
      </section>

      <!-- Center: Courses + compact nav -->
      <section class="panel">
        <div class="panel-inner stacked-panels" id="leftPanelStack">
          <div class="stack-header">
            <div class="panel-header-row">
              <div class="panel-header-titles">
                <div class="panel-header-title-large" id="leftHeaderTitle">Step 2: Pick your exact class</div>
                <div class="panel-header-sub" id="leftHeaderSubtitle">
                  We’ll match the schedule and locations once you choose the course.
                </div>
              </div>
            </div>
          </div>
          <div class="stack-body">
            <div class="body-note-sm">
              <span id="courseListMiniStatus" class="mini-status">Choose a family on the left to see available courses.</span>
            </div>
            <div id="courseListFull">
              <!-- Full-size course cards -->
            </div>
          </div>
          <div class="stack-footer">
            <div class="family-name-chip">
              <span>Viewing:</span>
              <strong id="currentFamilyLabel">No family selected yet</strong>
            </div>
            <div class="nav-right-pill">
              Tap any course to see real dates and locations on the right.
            </div>
          </div>
        </div>
      </section>

      <!-- Right: Sessions -->
      <section class="panel">
        <div class="panel-inner stacked-panels" id="rightPanelStack">
          <div class="stack-header">
            <div class="panel-header-row">
              <div class="panel-header-titles">
                <div class="panel-header-title-large" id="rightHeaderTitle">Live dates & locations</div>
                <div class="panel-header-sub" id="rightHeaderSubtitle">
                  Once you choose a course, your matching sessions will appear here.
                </div>
              </div>
              <button class="nav-back-wide" type="button" id="navBackBtn">
                <div class="nav-back-wide-main">
                  <div class="nav-arrow-pill">←</div>
                  <div class="nav-back-wide-labels">
                    <div class="nav-back-wide-label-main">Back</div>
                    <div class="nav-back-wide-label-sub">Adjust class family or course</div>
                  </div>
                </div>
                <div class="nav-back-wide-right">
                  Change selection
                </div>
              </button>
            </div>
          </div>
          <div class="stack-body">
            <div class="body-note-sm">
              <span>Click a date below to jump straight into Enrollware’s registration for that session.</span>
            </div>
            <div id="sessionsBody">
              <!-- Sessions will render here -->
            </div>
          </div>
          <div class="stack-footer">
            <div class="family-name-chip">
              <span>Course:</span>
              <strong id="sessionsTitle">No course selected yet</strong>
            </div>
            <div class="nav-right-pill" id="sessionsSubtext">
              You’ll see real dates, locations, and pricing once a course is selected.
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // ---- THEME IMAGE CONFIG ----
    // Default only; additional themes can be added later.
    const THEME_IMAGES = {
      "default": {
        logo: "assets/images/910CPR_wave.jpg",
        divider: "assets/images/theme/default-divider.png",
        corner: "assets/images/theme/default-corner.png"
      }
    };

    function applyThemeImages(themeName) {
      const cfg = THEME_IMAGES[themeName] || THEME_IMAGES["default"];

      const logoEl = document.getElementById("themeLogo");
      const dividerEl = document.getElementById("themeDivider");
      const cornerEl = document.getElementById("themeCorner");

      if (logoEl && cfg.logo) logoEl.src = cfg.logo;
      if (dividerEl && cfg.divider) dividerEl.src = cfg.divider;
      if (cornerEl && cfg.corner) cornerEl.src = cfg.corner;
    }

    // Use ACTIVE_THEME from theme-scheduler.js if available, otherwise default.
    const ACTIVE_THEME = (window.ACTIVE_THEME || "default");
    applyThemeImages(ACTIVE_THEME);

    // ---- Family definitions & images ----
    const FAMILY_DEFS = {
      "BLS": {
        key: "BLS",
        label: "BLS – Healthcare Provider CPR",
        blurb: "Standard BLS for hospital staff, EMS, and healthcare programs.",
        image: "assets/images/family/family-bls.jpg"
      },
      "ACLS": {
        key: "ACLS",
        label: "ACLS – Advanced Cardiac Life Support",
        blurb: "Advanced resuscitation for ER, ICU, and critical care providers.",
        image: "assets/images/family/family-acls.jpg"
      },
      "PALS": {
        key: "PALS",
        label: "PALS – Pediatric Life Support",
        blurb: "Pediatric emergencies, respiratory failure, and cardiac arrest.",
        image: "assets/images/family/family-pals.jpg"
      },
      "CPR_AED": {
        key: "CPR_AED",
        label: "CPR/AED – Adult & Pediatric",
        blurb: "Non-medical jobs needing CPR and AED skills without full First Aid.",
        image: "assets/images/family/family-cpr-aed.jpg"
      },
      "FA_CPR_AED": {
        key: "FA_CPR_AED",
        label: "First Aid / CPR / AED",
        blurb: "Full workplace package – First Aid, CPR, and AED together.",
        image: "assets/images/family/family-fa-cpr-aed.jpg"
      },
      "INSTRUCTOR": {
        key: "INSTRUCTOR",
        label: "Instructor Classes",
        blurb: "Train-the-Trainer programs for future CPR & First Aid instructors.",
        image: "assets/images/910CPR_wave.jpg"
      },
      "OTHER": {
        key: "OTHER",
        label: "Other Programs & Online",
        blurb: "Specialty programs, online options, and classes that don’t fit neatly above.",
        image: "assets/images/910CPR_wave.jpg"
      }
    };

    // Determine family from course name
    function getFamilyKeyFromCourseName(name) {
      const n = (name || "").toLowerCase();

      if (n.includes("instructor")) return "INSTRUCTOR";

      if (n.includes("acls")) return "ACLS";
      if (n.includes("pals")) return "PALS";

      const hasBls = n.includes("bls");
      if (hasBls) return "BLS";

      const hasCPR = n.includes("cpr") || n.includes("c.p.r");
      const hasAED = n.includes("aed");
      const hasFirstAid = n.includes("first aid") || n.includes("first-aid");

      if (hasFirstAid && hasCPR && hasAED) return "FA_CPR_AED";
      if (hasCPR && hasAED) return "CPR_AED";

      return "OTHER";
    }

    // schedule.json -> organized structure
    function buildFamiliesFromSchedule(schedule) {
      const sessions = schedule.sessions || [];
      const byCourseId = {};

      // Group sessions by course_id, ignore non-class rows
      sessions.forEach(sess => {
        const url = sess.register_url || "";
        if (!url || !url.includes("id=")) return;

        const cid = String(sess.course_id || sess.course_name || "unknown");
        if (!byCourseId[cid]) {
          byCourseId[cid] = {
            courseId: cid,
            name: sess.course_name || ("Course " + cid),
            sessions: []
          };
        }
        byCourseId[cid].sessions.push(sess);
      });

      // Convert to family array
      const familiesMap = {};
      Object.values(byCourseId).forEach(course => {
        const familyKey = getFamilyKeyFromCourseName(course.name);
        if (!familiesMap[familyKey]) {
          familiesMap[familyKey] = [];
        }
        familiesMap[familyKey].push(course);
      });

      // Sort courses within each family by name
      Object.keys(familiesMap).forEach(fk => {
        familiesMap[fk].sort((a, b) => {
          const an = (a.name || "").toLowerCase();
          const bn = (b.name || "").toLowerCase();
          return an.localeCompare(bn);
        });
      });

      // Turn into array, sorted by a preferred family order
      const familyOrder = ["BLS", "ACLS", "PALS", "CPR_AED", "FA_CPR_AED", "INSTRUCTOR", "OTHER"];
      const familiesArray = [];

      familyOrder.forEach(fk => {
        if (familiesMap[fk] && familiesMap[fk].length) {
          familiesArray.push({
            familyKey: fk,
            courses: familiesMap[fk]
          });
        }
      });

      return familiesArray;
    }

    // ---- DOM references ----
    const familyListEl = document.getElementById("familyList");
    const courseListFullEl = document.getElementById("courseListFull");
    const courseListCompactEl = document.getElementById("courseListCompact");
    const courseListMiniStatusEl = document.getElementById("courseListMiniStatus");
    const sessionsTitleEl = document.getElementById("sessionsTitle");
    const sessionsSubtextEl = document.getElementById("sessionsSubtext");
    const sessionsBodyEl = document.getElementById("sessionsBody");
    const leftPanelStackEl = document.getElementById("leftPanelStack");
    const rightPanelStackEl = document.getElementById("rightPanelStack");
    const leftHeaderTitleEl = document.getElementById("leftHeaderTitle");
    const leftHeaderSubtitleEl = document.getElementById("leftHeaderSubtitle");
    const rightHeaderTitleEl = document.getElementById("rightHeaderTitle");
    const rightHeaderSubtitleEl = document.getElementById("rightHeaderSubtitle");
    const navBackBtn = document.getElementById("navBackBtn");
    const currentFamilyLabelEl = document.getElementById("currentFamilyLabel");

    let familiesData = [];
    let courseDescriptionsById = {};
    let selectedFamilyKey = null;
    let selectedCourseId = null;
    let viewMode = "families"; // or "course-detail"

    function setViewMode(mode) {
      viewMode = mode;
      if (!leftPanelStackEl || !rightPanelStackEl) return;

      if (mode === "families") {
        leftPanelStackEl.classList.remove("mode-course-detail");
        leftPanelStackEl.classList.add("mode-families");
        rightPanelStackEl.classList.remove("mode-course-detail");
        rightPanelStackEl.classList.add("mode-families");

        leftHeaderTitleEl.textContent = "Step 2: Pick your exact class";
        leftHeaderSubtitleEl.textContent = "We’ll match the schedule and locations once you choose the course.";
        rightHeaderTitleEl.textContent = "Live dates & locations";
        rightHeaderSubtitleEl.textContent = "Once you choose a course, your matching sessions will appear here.";
      } else {
        leftPanelStackEl.classList.remove("mode-families");
        leftPanelStackEl.classList.add("mode-course-detail");
        rightPanelStackEl.classList.remove("mode-families");
        rightPanelStackEl.classList.add("mode-course-detail");

        leftHeaderTitleEl.textContent = "Step 2: Pick your exact class";
        leftHeaderSubtitleEl.textContent = "Now showing only courses in your selected family.";
        rightHeaderTitleEl.textContent = "Step 3: Choose a date & location";
        rightHeaderSubtitleEl.textContent = "Click a session to go straight to Enrollware’s registration screen.";
      }
    }

    function getFamilyData(fKey) {
      return familiesData.find(f => f.familyKey === fKey) || null;
    }

    // Render families (left column)
    function renderFamilies() {
      if (!familyListEl) return;
      familyListEl.innerHTML = "";

      if (!familiesData.length) {
        familyListEl.innerHTML =
          '<div class="status-text">No live schedule data found. If this looks wrong, please text (910) 395-5193.</div>';
        return;
      }

      familiesData.forEach(fam => {
        const fKey = fam.familyKey;
        const def = FAMILY_DEFS[fKey] || {};
        const card = document.createElement("div");
        card.className = "family-card";
        if (fKey === selectedFamilyKey) {
          card.classList.add("selected");
        }

        const thumb = document.createElement("div");
        thumb.className = "family-thumb";
        const img = document.createElement("img");
        img.src = def.image || "assets/images/910CPR_wave.jpg";
        img.alt = def.label || fKey;
        thumb.appendChild(img);

        const main = document.createElement("div");
        main.className = "family-main";

        const title = document.createElement("div");
        title.className = "family-title";
        title.textContent = def.label || fKey;

        const blurb = document.createElement("div");
        blurb.className = "family-blurb";
        blurb.textContent = def.blurb || ("Courses that match " + fKey + ".");

        main.appendChild(title);
        main.appendChild(blurb);

        card.appendChild(thumb);
        card.appendChild(main);

        card.addEventListener("click", () => {
          selectedFamilyKey = fKey;
          selectedCourseId = null;
          setViewMode("families");
          renderFamilies();
          renderCoursesForFamily(fKey);
          renderCompactCoursesForFamily(fKey);
          renderSessionsForCourse(null);
        });

        familyListEl.appendChild(card);
      });

      const fam = getFamilyData(selectedFamilyKey);
      if (currentFamilyLabelEl) {
        const def = fam ? (FAMILY_DEFS[fam.familyKey] || {}) : null;
        currentFamilyLabelEl.textContent = def && def.label
          ? def.label
          : (fam ? fam.familyKey : "No family selected yet");
      }
    }

    // Render full course cards (center column)
    function renderCoursesForFamily(fKey) {
      if (!courseListFullEl) return;
      courseListFullEl.innerHTML = "";

      const fam = getFamilyData(fKey);
      if (!fam) {
        courseListFullEl.innerHTML =
          '<div class="status-text">No courses found for this family. Try another family on the left.</div>';
        return;
      }

      fam.courses.forEach(course => {
        const card = document.createElement("div");
        card.className = "course-card";
        if (course.courseId === selectedCourseId) {
          card.classList.add("selected");
        }

        const title = document.createElement("div");
        title.className = "course-title-main";
        title.textContent = course.name;

        const metaRow = document.createElement("div");
        metaRow.className = "course-meta-row";

        const chip = document.createElement("div");
        chip.className = "course-chip";
        const sessionCount = (course.sessions || []).length;
        chip.textContent = sessionCount > 0
          ? (sessionCount + " session" + (sessionCount !== 1 ? "s" : ""))
          : "Dates vary";

        const sub = document.createElement("div");
        sub.className = "course-subtext";
        sub.textContent = "Shows Wilmington, Burgaw, Jacksonville & onsite when available.";

        metaRow.appendChild(chip);
        metaRow.appendChild(sub);

        // Optional long description from course-descriptions.json
        const descData = courseDescriptionsById[String(course.courseId)];
        if (descData && descData.detail) {
          const descDiv = document.createElement("div");
          descDiv.className = "course-description";
          descDiv.textContent = descData.detail;
          card.appendChild(descDiv);
        }

        const footRow = document.createElement("div");
        footRow.className = "course-foot-row";
        const notes = document.createElement("div");
        notes.textContent = "Click to see all dates & locations.";
        const arrow = document.createElement("div");
        arrow.className = "chevron";
        arrow.textContent = "›";

        footRow.appendChild(notes);
        footRow.appendChild(arrow);

        card.appendChild(title);
        card.appendChild(metaRow);
        card.appendChild(footRow);

        card.addEventListener("click", () => {
          selectedFamilyKey = fKey;
          selectedCourseId = course.courseId;
          setViewMode("course-detail");
          renderFamilies();
          renderCompactCoursesForFamily(fKey);
          renderCoursesForFamily(fKey);
          renderSessionsForCourse(course.courseId);
        });

        courseListFullEl.appendChild(card);
      });
    }

    // Render compact courses (left column in course-detail mode)
    function renderCompactCoursesForFamily(fKey) {
      if (!courseListCompactEl || !courseListMiniStatusEl) return;

      const fam = getFamilyData(fKey);
      if (!fam) {
        courseListCompactEl.innerHTML = "";
        courseListMiniStatusEl.textContent = "No courses found. Try a different family on the left.";
        return;
      }

      const count = fam.courses.length;
      courseListMiniStatusEl.textContent =
        count > 0
          ? ("Showing " + count + " course" + (count !== 1 ? "s" : "") + " in this family.")
          : "No courses found in this family.";

      courseListCompactEl.innerHTML = "";
      fam.courses.forEach(course => {
        const mini = document.createElement("button");
        mini.type = "button";
        mini.className = "course-mini";
        if (course.courseId === selectedCourseId) {
          mini.classList.add("selected");
        }

        const dot = document.createElement("div");
        dot.className = "course-mini-dot";

        const nameSpan = document.createElement("span");
        nameSpan.textContent = course.name;

        const countSpan = document.createElement("span");
        const sessionCount = (course.sessions || []).length;
        countSpan.textContent = sessionCount > 0
          ? (sessionCount + "× dates")
          : "Dates vary";

        mini.appendChild(dot);
        mini.appendChild(nameSpan);
        mini.appendChild(countSpan);

        mini.addEventListener("click", () => {
          selectedCourseId = course.courseId;
          setViewMode("course-detail");
          renderFamilies();
          renderCompactCoursesForFamily(fKey);
          renderCoursesForFamily(fKey);
          renderSessionsForCourse(course.courseId);
        });

        courseListCompactEl.appendChild(mini);
      });
    }

    // Render sessions for a course (right column in course-detail mode)
    function renderSessionsForCourse(courseId) {
      if (!sessionsBodyEl) return;

      sessionsBodyEl.innerHTML = "";

      if (!courseId) {
        sessionsTitleEl.textContent = "No course selected yet";
        sessionsSubtextEl.textContent =
          "Pick a class family and course first. Then we’ll show all matching live dates and locations.";
        return;
      }

      const fam = getFamilyData(selectedFamilyKey);
      if (!fam) return;
      const course = fam.courses.find(c => c.courseId === courseId);
      if (!course) return;

      sessionsTitleEl.textContent = course.name;
      sessionsSubtextEl.textContent =
        "Pick the time and location that works best. We’ll send you straight to Enrollware for this class.";

      const sessions = course.sessions || [];
      sessionsBodyEl.innerHTML = "";

      if (!sessions.length) {
        sessionsBodyEl.innerHTML =
          '<div class="no-sessions">No live dates are scheduled yet for this course. Call or text (910) 395-5193 and we’ll help you plan the next session.</div>';
        return;
      }

      sessions.forEach(sess => {
        const card = document.createElement("div");
        card.className = "session-card";

        const mainRow = document.createElement("div");
        mainRow.className = "session-main-row";

        const dateDiv = document.createElement("div");
        dateDiv.className = "session-date";

        const start = sess.start_display || "";
        const parts = start.split(" at ");
        const dateLabel = parts[0] || start;
        const timeLabel = parts[1] || "";
        dateDiv.textContent = dateLabel;

        const timeDiv = document.createElement("div");
        timeDiv.textContent = timeLabel;

        mainRow.appendChild(dateDiv);
        mainRow.appendChild(timeDiv);

        const locDiv = document.createElement("div");
        locDiv.className = "session-location";
        locDiv.textContent = sess.location_short || sess.location || "";

        const footRow = document.createElement("div");
        footRow.className = "session-foot-row";

        const priceDiv = document.createElement("div");
        priceDiv.className = "session-price";
        const rawPrice = (sess.price || "").toString().trim();
        if (rawPrice) {
          priceDiv.textContent = rawPrice;
        } else {
          priceDiv.textContent = "";
        }

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "session-btn";
        btn.innerHTML = '<span>Register</span> <span>⟶</span>';
        const url = sess.register_url || "";
        btn.addEventListener("click", () => {
          if (url) {
            window.location.href = url;
          }
        });

        footRow.appendChild(priceDiv);
        footRow.appendChild(btn);

        card.appendChild(mainRow);
        card.appendChild(locDiv);
        card.appendChild(footRow);

        sessionsBodyEl.appendChild(card);
      });
    }

    // Back button:
    if (navBackBtn) {
      navBackBtn.addEventListener("click", () => {
        if (viewMode === "course-detail") {
          setViewMode("families");
          selectedCourseId = null;
          renderCoursesForFamily(selectedFamilyKey);
          renderCompactCoursesForFamily(selectedFamilyKey);
          renderSessionsForCourse(null);
        } else {
          selectedFamilyKey = null;
          selectedCourseId = null;
          setViewMode("families");
          renderFamilies();
          if (courseListFullEl) courseListFullEl.innerHTML = "";
          if (courseListCompactEl) courseListCompactEl.innerHTML = "";
          if (courseListMiniStatusEl) {
            courseListMiniStatusEl.textContent = "Choose a family on the left to see available courses.";
          }
          renderSessionsForCourse(null);
        }
      });
    }

    async function initSchedule() {
      try {
        const [schedResp, descResp] = await Promise.all([
          fetch("data/schedule.json", { cache: "no-store" }),
          fetch("data/course-descriptions.json", { cache: "no-store" })
        ]);

        if (!schedResp.ok) throw new Error("schedule.json HTTP " + schedResp.status);
        const schedule = await schedResp.json();
        familiesData = buildFamiliesFromSchedule(schedule);

        if (descResp.ok) {
          const descJson = await descResp.json();
          const map = {};
          (descJson.courses || []).forEach(c => {
            if (c && typeof c.course_id !== "undefined") {
              const cid = String(c.course_id);
              map[cid] = c;
            }
          });
          courseDescriptionsById = map;
        } else {
          courseDescriptionsById = {};
        }
      } catch (err) {
        console.error("Failed to load schedule.json and/or course-descriptions.json; page will be mostly empty:", err);
        familiesData = [];
        courseDescriptionsById = {};
      }

      if (familiesData.length) {
        selectedFamilyKey = familiesData[0].familyKey;
      }

      renderFamilies();
      if (selectedFamilyKey) {
        renderCoursesForFamily(selectedFamilyKey);
        renderCompactCoursesForFamily(selectedFamilyKey);
      }
      renderSessionsForCourse(null);
      setViewMode("families");
    }

    initSchedule();
  </script>
</body>
</html>
