<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>910CPR – Courses & Schedule</title>

<!-- GA4 -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-45PBWBK7KR"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)};gtag('js',new Date());gtag('config','G-45PBWBK7KR');</script>

<!-- GTM -->
<script>
(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});
var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';
j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K58Z4XD');
</script>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K58Z4XD" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<style>
:root{
  --ink:#0a1b2b; --bg:#f6f9fc; --card:#fff; --edge:#dce9f7; --muted:#5c6a78;
  --hover:#f3f8ff; --shadow:0 8px 24px rgba(0,0,0,.10);
  --bannerTop:#32415f; --bannerBot:#27354e; --bannerText:#f4f7fb;
  --btn:#0b66c3; --btnText:#fff;

  /* category colors */
  --bls:#0b66c3;  /* blue */
  --acls:#b31d2c; /* red */
  --pals:#5b4abf; /* purple */
  --fa:#485563;   /* slate */
}
@media (prefers-color-scheme: dark){
  :root{
    --ink:#e9eef6; --bg:#0f1722; --card:#111c2a; --edge:#263548; --muted:#a7b6c6;
    --hover:#0e253f; --shadow:0 10px 30px rgba(0,0,0,.45);
    --bannerTop:#1c2a40; --bannerBot:#152133; --bannerText:#dfe7f3;
    --btn:#2a7be6; --btnText:#fff;
    --bls:#2a7be6; --acls:#e14c59; --pals:#7a66ff; --fa:#7b8896;
  }
}
*{box-sizing:border-box}
body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:var(--bg);color:var(--ink)}
.wrap{max-width:1120px;margin:auto;padding:20px}
h1{margin:0 0 14px}

/* Popular block */
.popular{
  background:var(--card); border:1px solid var(--edge); border-radius:16px;
  padding:18px; box-shadow:var(--shadow); margin:8px 0 22px;
}
.popular h2{margin:0 0 12px;font-size:20px}
.popular .grid{display:grid; gap:12px; grid-template-columns:1fr;}
@media (min-width:640px){ .popular .grid{ grid-template-columns:1fr 1fr; } }     /* 2-col */
@media (min-width:960px){ .popular .grid{ grid-template-columns:repeat(4,1fr); } } /* 4-col */

/* Buttony cards */
.popbtn{
  display:block; text-decoration:none; color:var(--btnText);
  border-radius:14px; padding:14px 14px 12px;
  box-shadow:0 8px 22px rgba(0,0,0,.18);
  border:1px solid rgba(255,255,255,.2);
  transform:translateY(0); transition:transform .08s ease, box-shadow .12s ease, filter .12s ease;
}
.popbtn:hover{ transform:translateY(-1px); filter:brightness(1.02); box-shadow:0 10px 28px rgba(0,0,0,.22); }
.popbtn:active{ transform:translateY(0); box-shadow:0 6px 16px rgba(0,0,0,.18); }

.popbtn .title{
  font-weight:800; font-size:14px; letter-spacing:.2px; line-height:1.2;
  opacity:.95; margin:0 0 6px;
}
.popbtn .sub{
  display:block; font-size:12.5px; line-height:1.3; opacity:.98;
}

/* color variants – solid button look */
.popbtn.cat-bls{ background:linear-gradient(180deg,#3e8bf0,var(--bls)); }
.popbtn.cat-acls{ background:linear-gradient(180deg,#ff6b76,var(--acls)); }
.popbtn.cat-pals{ background:linear-gradient(180deg,#9c8cff,var(--pals)); }
.popbtn.cat-fa{ background:linear-gradient(180deg,#7a8a98,var(--fa)); }

/* Placeholder sections (75% width header centered, own row) */
details.section{margin:28px 0;border-radius:14px;background:var(--card);border:1px solid var(--edge);overflow:hidden;box-shadow:var(--shadow)}
details.section>summary{cursor:pointer;list-style:none;padding:0}
.ph-head{
  width:75%; margin:0 auto;
  display:block; padding:16px 18px;
  border-bottom:1px solid var(--edge);
  background:linear-gradient(180deg,var(--bannerTop),var(--bannerBot)); color:var(--bannerText)
}
.ph-title{font-weight:900;font-size:1.05rem}
.ph-sub{font-size:12px;opacity:.9;margin-top:6px}
.section-body{padding:16px}

/* Course grid (2 columns on desktop) */
.section-body .courses{display:grid;grid-template-columns:1fr;gap:14px}
@media (min-width:900px){ .section-body .courses{grid-template-columns:1fr 1fr} }

/* Course cards */
details.course{border:1px solid var(--edge);border-radius:12px;overflow:hidden;background:var(--card)}
details.course>summary{list-style:none;cursor:pointer;font-weight:700;padding:12px 16px;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,0));border-bottom:1px solid var(--edge)}
details.course[open]>summary{background:var(--hover)}
.course-title{font-weight:800}

/* Course body */
details.course .body{padding:14px 16px}
.course-head{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
.course-head a.hlink{color:var(--btn);text-decoration:none;font-weight:800}
.course-head a.hlink:hover{text-decoration:underline}
.meta{font-size:12px;color:var(--muted);margin:10px 0 0}
.btn{display:inline-block;border:1px solid var(--edge);border-radius:8px;padding:6px 10px;text-decoration:none;color:var(--btn);background:var(--card)}
.btn:hover{background:var(--hover)}

/* Sessions grid (always show in-page list; 2 columns desktop) */
.enrclass-list{list-style:none;padding:0;margin:12px 0;display:grid;gap:10px;grid-template-columns:1fr}
@media (min-width:900px){ .enrclass-list{grid-template-columns:1fr 1fr} }
.enrclass-list li{margin:0}
.enrclass-list a{display:flex;flex-direction:column;gap:4px;border:1px solid var(--edge);border-radius:10px;padding:10px 12px;text-decoration:none;color:var(--ink);background:var(--card)}
.enrclass-list a:hover{background:var(--hover)}
</style>
</head>

<body>
<div class="wrap">
  <h1>910CPR Courses & Schedule</h1>

  <!-- Quick Selection -->
  <section class="popular" id="popular">
    <h2>Most popular courses</h2>
    <div class="grid" id="popular-grid"></div>
  </section>

  <!-- Catalog sections get injected here -->
  <div id="catalog"></div>
</div>

<script>
const ENR_ORIGIN='https://coastalcprtraining.enrollware.com';
const isCt=id=>typeof id==='string' && /^ct\d{3,}$/i.test(id);
const ctHref=id=>`${ENR_ORIGIN}/schedule#${encodeURIComponent(id)}`;

function catFromTitle(t){
  const s=(t||'').toLowerCase();
  if(s.includes('bls')) return 'bls';
  if(s.includes('acls')) return 'acls';
  if(s.includes('pals')) return 'pals';
  if(s.includes('first aid')||s.includes('heartsaver')||s.includes('cpr')) return 'fa';
  return 'bls';
}

// Compact titles; details in sub line
const popularPlan = [
  { hint:'AHA – BLS Provider - In-person Initial',  sub:'Instructor-led BLS for healthcare providers' },
  { hint:'AHA – BLS Provider - Online Class',       sub:'HeartCode BLS + hands-on skills test' },
  { hint:'AHA – ACLS Provider - In-person Renewal', sub:'Renew ACLS with instructor-led session' },
  { hint:'AHA – ACLS Provider (HeartCode + Skills)',sub:'ACLS HeartCode + fast skills check' },
  { hint:'AHA – PALS Provider - In-person Renewal', sub:'Renew PALS with instructor-led session' },
  { hint:'AHA – PALS Provider (HeartCode + Skills)',sub:'PALS HeartCode + fast skills check' },
  { hint:'HSI First Aid/CPR/AED (In-Person)',       sub:'Adult First Aid with CPR/AED (HSI card)' },
  { hint:'AHA – Heartsaver Online',                 sub:'Online Heartsaver + quick skills test' },
];

function absolutizeUrls(frag){
  frag.querySelectorAll('img,a').forEach(el=>{
    const attr=el.tagName==='IMG'?'src':'href';
    const v=el.getAttribute(attr); if(!v) return;
    if(/^https?:\/\//i.test(v)) return;
    const abs=v.startsWith('/')?ENR_ORIGIN+v:ENR_ORIGIN+'/'+v.replace(/^\.?\//,'');
    el.setAttribute(attr,abs);
  });
  return frag;
}

function getCtId(panel,root){
  let a=panel.querySelector('[id^="ct"],[name^="ct"]');
  if(a&&isCt(a.id||a.name))return a.id||a.name;
  const link=panel.querySelector('a[href*="#ct"]');
  if(link){const m=link.href.match(/#(ct\d+)/i);if(m)return m[1];}
  let prev=panel.previousElementSibling;
  for(let i=0;i<6&&prev;i++){
    if(prev.matches?.('[id^="ct"],[name^="ct"]')) return prev.id||prev.name;
    const inner=prev.querySelector?.('[id^="ct"],[name^="ct"]'); if(inner) return inner.id||inner.name;
    prev=prev.previousElementSibling;
  }
  const walker=document.createTreeWalker(root,NodeFilter.SHOW_ELEMENT);
  let last='';while(walker.nextNode()){
    const el=walker.currentNode; if(el===panel)break;
    const id=el.id||el.name; if(isCt(id)) last=id;
  }return last;
}

function parseDateFromText(t){
  if(!t)return null;const s=t.trim();
  const m=s.match(/([A-Za-z]+)\s+(\d{1,2}),\s*(\d{4})\s+at\s+(\d{1,2}):(\d{2})\s*(AM|PM)/i);
  if(!m)return null;const months={january:0,february:1,march:2,april:3,may:4,june:5,july:6,august:7,september:8,october:9,november:10,december:11};
  let h=+m[4];if(m[6].toUpperCase()==='PM'&&h<12)h+=12;if(m[6].toUpperCase()==='AM'&&h===12)h=0;
  return new Date(+m[3],months[m[1].toLowerCase()],+m[2],h,+m[5]);
}
function limitUlToWindow(ul,maxDays=28,maxItems=10){
  if(!ul)return{ul,kept:0,total:0};
  const cutoff=new Date();cutoff.setDate(cutoff.getDate()+maxDays);
  const lis=[...ul.querySelectorAll(':scope>li')];let kept=0,total=0;
  for(const li of lis){total++;
    const a=li.querySelector('a');const txt=a?.textContent||li.textContent||'';
    const dt=parseDateFromText(txt);
    if(!dt||(dt<=cutoff&&kept<maxItems))kept++;else li.remove();
  }
  return{ul,kept,total};
}

async function loadSnapshotHTML(){
  const here=location.pathname,base=here.replace(/[^/]+$/,'');
  const tries=[ base+'data/enrollware-schedule.html', '/ew2landers/data/enrollware-schedule.html', 'data/enrollware-schedule.html' ];
  for(const u of tries){ try{ const r=await fetch(u,{cache:'no-cache'}); if(r.ok) return await r.text(); } catch{} }
  return null;
}

document.addEventListener('DOMContentLoaded',async()=>{
  const container=document.getElementById('catalog');
  const popularGrid=document.getElementById('popular-grid');

  const html=await loadSnapshotHTML();
  if(!html){ container.innerHTML='<p class="muted">Schedule snapshot not found.</p>'; return; }

  const root=document.createElement('div'); root.innerHTML=html;

  // Build index for popular links
  const ctIndex=[];
  root.querySelectorAll('.enrpanel').forEach(p=>{
    const title=(p.querySelector('.enrpanel-heading,h1,h2,h3,h4')?.textContent||'').trim();
    const ctId=getCtId(p,root);
    if(title&&ctId) ctIndex.push({title,ctId});
  });

  // Popular buttons
  popularPlan.forEach(item=>{
    const found=ctIndex.find(x=>x.title.toLowerCase().includes(item.hint.toLowerCase()));
    const title = found ? found.title : item.hint;
    const href  = found ? ctHref(found.ctId) : `${ENR_ORIGIN}/schedule`;
    const cat   = catFromTitle(title);
    const a=document.createElement('a');
    a.className='popbtn cat-'+cat; a.href=href;
    a.innerHTML=`<div class="title">${title}</div><span class="sub">${item.sub}</span>`;
    popularGrid.appendChild(a);
  });

  // Build sections and courses from snapshot
  const panels=[...root.querySelectorAll('.enrpanel')];
  const sections=[]; let current=null;

  for(const p of panels){
    const headingEl=p.querySelector('.enrpanel-heading,h1,h2,h3,h4'); if(!headingEl) continue;
    const headingFrag=headingEl.cloneNode(true); absolutizeUrls(headingFrag);
    const titleHTML=headingFrag.innerHTML.trim();

    const bodyEl=p.querySelector('.enrpanel-body');
    const descClone=bodyEl?bodyEl.cloneNode(true):null;
    if(descClone){const u=descClone.querySelector('ul.enrclass-list'); if(u) u.remove();}
    if(descClone) absolutizeUrls(descClone);
    const descHTML=descClone?(descClone.innerHTML||'').trim():'';

    const ul=p.querySelector('ul.enrclass-list');
    const hasDates=!!ul;

    if(!hasDates){
      current={header:{titleHTML,descHTML},courses:[]}; sections.push(current);
      continue;
    }
    if(!current){ current={header:{titleHTML:'Courses',descHTML:''},courses:[]}; sections.push(current); }

    const ulClone=ul.cloneNode(true); absolutizeUrls(ulClone);
    const trimmed=limitUlToWindow(ulClone,28,10);
    const ctId=getCtId(p,root);
    current.courses.push({id:ctId,titleHTML,descHTML,ul:trimmed.ul,kept:trimmed.kept,total:trimmed.total});
  }

  // Render sections & courses (auto-open all top-level)
  const frag=document.createDocumentFragment();
  sections.forEach(sec=>{
    const secEl=document.createElement('details'); secEl.className='section'; secEl.open=true;
    secEl.innerHTML=`<summary>
      <div class="ph-head">
        <div class="ph-title">${sec.header.titleHTML}</div>
        ${sec.header.descHTML?`<div class="ph-sub">${sec.header.descHTML}</div>`:''}
      </div>
    </summary>
    <div class="section-body"><div class="courses"></div></div>`;
    const grid=secEl.querySelector('.courses');

    sec.courses.forEach(c=>{
      const course=document.createElement('details'); course.className='course';
      const allUrl=isCt(c.id)?ctHref(c.id):`${ENR_ORIGIN}/schedule`;
      course.innerHTML=`<summary><span class="course-title">${c.titleHTML}</span></summary>
        <div class="body">
          <div class="course-head">
            <!-- Primary link lives here; summaries stay clean -->
            <a class="hlink" href="${allUrl}">${c.titleHTML}</a>
            <a class="btn" href="${allUrl}">See all dates</a>
          </div>
          <div class="desc" style="margin-top:10px">${c.descHTML}</div>
          <ul class="enrclass-list"></ul>
          <div class="meta">${c.total>c.kept?`Showing ${c.kept} of ${c.total} upcoming (~4 weeks)`:`All upcoming shown`}</div>
        </div>`;
      course.querySelector('.enrclass-list').replaceWith(c.ul);
      grid.appendChild(course);
    });

    frag.appendChild(secEl);
  });

  container.textContent='';
  container.appendChild(frag);

  // Ensure ALL top-level sections are open (redundant but explicit)
  document.querySelectorAll('details.section').forEach(d=>{ d.open=true; });
});
</script>

<!-- Voice widget -->
<embeddable-voice id="1cf9bf8f-38da-437e-abfb-efa1ce9a02ff"></embeddable-voice>
<script src="https://cdn.247aireceptionist.com/script.js"></script>
</body>
</html>
