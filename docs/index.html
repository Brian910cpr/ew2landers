<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>910CPR ‚Äì Live Class Schedule (Desktop)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Optional base CSS / theme hooks if they exist -->
  <link rel="stylesheet" href="assets/css/main.css">
  <link rel="stylesheet" href="assets/css/themes.css">
<script src="assets/js/theme-scheduler.js" defer></script>

  <style>
    :root {
      --bg-page: #f4f6fb;
      --bg-panel: #ffffff;
      --bg-panel-alt: #f9fafb;
      --border-subtle: #e5e7eb;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.12);
      --radius-lg: 18px;
      --radius-md: 12px;
      --text-main: #111827;
      --text-muted: #6b7280;
      --accent-main: #0d47a1;
      --accent-soft: rgba(13, 71, 161, 0.08);
      --accent-strong: #2563eb;
      --selected-bg: #e0edff;
      --selected-border: #2563eb;
      --transition-fast: 0.25s ease;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #dde9ff 0, #f4f6fb 52%, #edf2ff 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Top GoDaddy-style header */
    .top-bar {
      height: 54px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 18px;
      background: linear-gradient(135deg, #0d47a1, #020617);
      color: #e5e7eb;
      box-shadow: 0 4px 18px rgba(15, 23, 42, 0.55);
      z-index: 20;
      position: relative;
    }

    .top-bar-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .top-bar-logo {
      padding: 3px;
      border-radius: 10px;
      background: rgba(15, 23, 42, 0.55);
      border: 1px solid rgba(255, 255, 255, 0.35);
    }

    .top-bar-logo img {
      display: block;
      max-height: 40px;
      width: auto;
      border-radius: 7px;
    }

    .top-bar-title {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .top-bar-title-main {
      font-size: 15px;
      font-weight: 600;
    }

    .top-bar-title-sub {
      font-size: 11px;
      color: #d1d5db;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 11px;
    }

    .top-chip {
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(209, 213, 219, 0.7);
      background: rgba(15, 23, 42, 0.6);
      color: #e5e7eb;
      white-space: nowrap;
    }

    .top-link {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.25);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
    }

    .top-link span.icon {
      font-size: 14px;
    }

    /* Main layout */
    .page-shell {
      padding: 14px;
      position: relative;
    }

    .schedule-shell {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.85);
      border-radius: 22px;
      padding: 10px 10px 10px 0;
      box-shadow: var(--shadow-soft);
      display: flex;
      min-height: calc(100vh - 90px);
      backdrop-filter: blur(14px);
      position: relative;
    }

    /* Left arrow strip */
    .nav-arrow-strip {
      width: 46px;
      flex-shrink: 0;
      border-radius: 22px 0 0 22px;
      overflow: hidden;
    }

    .nav-arrow-button {
      width: 100%;
      height: 100%;
      border-radius: 22px 0 0 22px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: linear-gradient(180deg, #020617, #0f172a);
      color: #e5e7eb;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.65);
    }

    .nav-arrow-button:hover {
      background: #020617;
    }

    /* Center columns */
    .schedule-main {
      flex: 1;
      display: flex;
      gap: 10px;
      padding: 6px 10px 6px 10px;
    }

    .column {
      border-radius: 16px;
      background: var(--bg-panel);
      box-shadow: 0 5px 20px rgba(15, 23, 42, 0.12);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .column-left {
      width: 32%;
      min-width: 240px;
      max-width: 320px;
    }

    .column-right {
      flex: 1;
      min-width: 0;
    }

    .column-header {
      padding: 10px 12px 8px;
      border-bottom: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .column-title {
      font-size: 13px;
      font-weight: 600;
    }

    .column-subtitle {
      font-size: 11px;
      color: var(--text-muted);
    }

    .column-body {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px 10px;
      background: linear-gradient(180deg, #f9fafb, #eef2ff);
    }

    /* Panel stacks for slide animation */
    .panel-stack {
      position: relative;
      height: 100%;
      overflow: hidden;
    }

    .stack-panel {
      position: absolute;
      inset: 0;
      padding: 0;
      transition: transform var(--transition-fast);
    }

    /* left stack modes */
    .panel-stack-left.mode-families .panel-families {
      transform: translateX(0);
    }
    .panel-stack-left.mode-families .panel-courses-left {
      transform: translateX(100%);
    }
    .panel-stack-left.mode-course-detail .panel-families {
      transform: translateX(-100%);
    }
    .panel-stack-left.mode-course-detail .panel-courses-left {
      transform: translateX(0);
    }

    /* right stack modes */
    .panel-stack-right.mode-families .panel-courses-right {
      transform: translateX(0);
    }
    .panel-stack-right.mode-families .panel-sessions {
      transform: translateX(100%);
    }
    .panel-stack-right.mode-course-detail .panel-courses-right {
      transform: translateX(-100%);
    }
    .panel-stack-right.mode-course-detail .panel-sessions {
      transform: translateX(0);
    }

    /* Family cards */
    .family-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding-right: 2px;
    }

    .family-card {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 7px 8px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: rgba(255, 255, 255, 0.92);
      cursor: pointer;
      transition: background var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast), transform 0.12s ease-out;
    }

    .family-card:hover {
      background: #e5efff;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.15);
    }

    .family-card.active {
      border-color: var(--selected-border);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.45);
      background: #e0edff;
      transform: translateY(-1px);
    }

    .family-image {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      overflow: hidden;
      flex-shrink: 0;
      background: #cbd5f5;
    }

    .family-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .family-text-main {
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .family-text-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Courses list (right, in families mode) */
    .course-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      padding-right: 2px;
    }

    .course-card {
      border-radius: var(--radius-md);
      border: 1px solid rgba(148, 163, 184, 0.55);
      background: rgba(255, 255, 255, 0.96);
      padding: 8px 10px 9px;
      cursor: pointer;
      box-shadow: 0 4px 14px rgba(15, 23, 42, 0.11);
      transition: background var(--transition-fast), border-color var(--transition-fast), box-shadow var(--transition-fast), transform 0.12s ease-out;
    }

    .course-card:hover {
      background: #eef2ff;
      border-color: var(--accent-main);
      transform: translateY(-1px);
    }

    .course-card.selected {
      background: var(--selected-bg);
      border-color: var(--selected-border);
      box-shadow: 0 6px 18px rgba(37, 99, 235, 0.4);
    }

    .course-title-main {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 3px;
    }

    .course-meta-row {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-bottom: 4px;
    }

    .course-chip {
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-main);
      font-weight: 500;
      white-space: nowrap;
    }

    .course-subtext {
      font-size: 11px;
      color: var(--text-muted);
    }

    .course-foot-row {
      font-size: 10px;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
    }

    /* Course list when it slides to the left column */
    .course-list-compact {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding-right: 2px;
    }

    .course-pill {
      font-size: 12px;
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(255, 255, 255, 0.96);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .course-pill span.label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .course-pill span.count {
      font-size: 10px;
      color: var(--text-muted);
    }

    .course-pill.selected {
      background: var(--selected-bg);
      border-color: var(--selected-border);
      box-shadow: 0 3px 10px rgba(37, 99, 235, 0.4);
    }

    /* Sessions panel */
    .sessions-shell {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .sessions-header {
      padding: 8px 11px 7px;
      border-bottom: 1px solid var(--border-subtle);
      background: var(--selected-bg);
    }

    .sessions-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 2px;
    }

    .sessions-subtext {
      font-size: 11px;
      color: var(--text-muted);
    }

    .sessions-body {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px 10px;
      background: linear-gradient(180deg, var(--selected-bg), #eef2ff);
    }

    .session-card {
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.65);
      background: rgba(255, 255, 255, 0.96);
      padding: 7px 9px 7px;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
    }

    .session-main-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 11px;
    }

    .session-date {
      font-weight: 600;
    }

    .session-location {
      font-size: 10px;
      color: var(--text-muted);
    }

    .session-foot-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 2px;
      font-size: 10px;
    }

    .session-price {
      color: var(--text-muted);
      font-style: italic;
    }

    .session-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 0;
      background: var(--accent-strong);
      color: #ffffff;
      font-size: 11px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(37, 99, 235, 0.6);
    }

    .session-btn:active {
      transform: translateY(1px);
      box-shadow: 0 1px 5px rgba(37, 99, 235, 0.8);
    }

    .no-sessions {
      font-size: 12px;
      color: var(--text-muted);
      padding: 8px 4px;
    }

    /* Right theme stripe */
    .theme-stripe {
      width: 32px;
      border-radius: 0 22px 22px 0;
      background:
        linear-gradient(180deg, rgba(15, 23, 42, 0.04), rgba(15, 23, 42, 0.18)),
        repeating-linear-gradient(
          135deg,
          rgba(59, 130, 246, 0.16),
          rgba(59, 130, 246, 0.16) 4px,
          rgba(129, 140, 248, 0.04) 4px,
          rgba(129, 140, 248, 0.04) 10px
        );
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 4px;
      flex-shrink: 0;
    }

    .theme-stripe img {
      max-height: 100%;
      width: auto;
      display: block;
      border-radius: 999px;
    }

    /* Small status text */
    .status-text {
      font-size: 11px;
      color: var(--text-muted);
      padding: 6px 8px 0;
    }

    /* Bottom-right theme decoration */
    .theme-corner-img {
      position: absolute;
      right: 8px;
      bottom: 6px;
      width: 90px;
      max-width: 22vw;
      opacity: 0.3;
      pointer-events: none;
    }

    /* Basic responsiveness: stack on narrow screens */
    @media (max-width: 900px) {
      .schedule-shell {
        flex-direction: column;
        padding: 8px;
      }
      .nav-arrow-strip {
        width: 100%;
        height: 40px;
        border-radius: 18px 18px 0 0;
      }
      .nav-arrow-button {
        border-radius: 18px 18px 0 0;
      }
      .schedule-main {
        flex-direction: column;
        padding: 6px 2px 6px 2px;
      }
      .column-left {
        width: 100%;
        max-width: none;
        min-width: 0;
      }
      .column-right {
        width: 100%;
      }
      .theme-stripe {
        width: 100%;
        height: 32px;
        border-radius: 0 0 18px 18px;
      }
      .theme-stripe img {
        max-height: 24px;
      }
      .theme-corner-img {
        display: none;
      }
    }
/* ==== Desktop readability & polish overrides ==== */

/* Make overall desktop text a bit larger */
body {
  font-size: 16px;
}

@media (min-width: 900px) {
  body {
    font-size: 17px;
  }
}

/* Back button: not black, but clearly a control */
.back-link {
  background: #ffffffee;          /* soft white chip, not black */
  color: #074a86;                 /* deep blue text */
  border-color: #b3c3dd;          /* lighter border */
  font-weight: 500;
}

.back-link:hover {
  background: #e5f0ff;
  text-decoration: none;
}

/* Seasonal divider: stretch and pick up page background */
.season-divider,
img[alt="Seasonal divider"] {
  display: block;
  width: 100%;                    /* fill its container */
  max-width: 100%;
  background: linear-gradient(
    to right,
    #ffffff,
    #e9f4ff,
    #ffffff
  );                               /* echo the page bg */
  border-radius: 999px;            /* keep it soft if it has alpha */
}

/* Bottom-corner decoration: about 3x current visual size */
.season-corner,
img[alt="Seasonal decoration"] {
  transform: scale(3);
  transform-origin: bottom right;  /* grow ‚Äúout‚Äù to the corner */
}

/* Slight bump on main headings on desktop */
@media (min-width: 900px) {
  h1 { font-size: 1.8rem; }
  h2 { font-size: 1.25rem; }
  .hero-copy,
  p {
    font-size: 0.98rem;
  }
}

  </style>
</head>
<body>
  <!-- Top header -->
  <header class="top-bar">
    <div class="top-bar-left">
      <div class="top-bar-logo">
        <!-- THEME LOGO: default is 910CPR_wave -->
        <img id="themeLogo" src="assets/images/910CPR_wave.jpg" alt="910CPR logo">
      </div>
      <div class="top-bar-title">
        <div class="top-bar-title-main">CPR, BLS, ACLS &amp; First Aid ‚Äì Wilmington / Burgaw / Jacksonville</div>
        <div class="top-bar-title-sub">Live &amp; blended classes with fast certificates ‚Äì powered by 910CPR</div>
      </div>
    </div>
    <div class="top-bar-right">
      <div class="top-chip">Live schedule ‚Äì data from Enrollware</div>
      <a class="top-link" href="index-mobile.html">
        <span class="icon">üì±</span>
        <span>Mobile view</span>
      </a>
      <a class="top-link" href="tel:+19103955193">
        <span class="icon">üìû</span>
        <span>Call or text (910) 395-5193</span>
      </a>
    </div>
  </header>

  <div class="page-shell">
    <div class="schedule-shell">
      <!-- Left arrow strip -->
      <aside class="nav-arrow-strip">
        <button class="nav-arrow-button" id="navBackBtn" title="Back">
          ‚Äπ
        </button>
      </aside>

      <!-- Center main area -->
      <section class="schedule-main">
        <!-- Left column: families ‚Üí courses list -->
        <div class="column column-left">
          <div class="column-header">
            <div>
              <div class="column-title" id="leftHeaderTitle">Step 1: Choose a class family</div>
              <div class="column-subtitle" id="leftHeaderSubtitle">
                We‚Äôll show only the classes that match this path.
              </div>
            </div>
          </div>
          <div class="column-body">
            <div class="panel-stack panel-stack-left mode-families" id="leftPanelStack">

              <!-- Families panel -->
              <div class="stack-panel panel-families">
                <div class="family-list" id="familyList">
                  <!-- injected families -->
                </div>
              </div>

              <!-- Compact courses panel (when in course-detail mode) -->
              <div class="stack-panel panel-courses-left">
                <div class="status-text" id="courseListMiniStatus">
                  Step 2: Pick the exact course in this family.
                </div>
                <div class="course-list-compact" id="courseListCompact">
                  <!-- injected compact course names -->
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Right column: courses ‚Üí sessions -->
        <div class="column column-right">
          <div class="column-header">
            <div>
              <div class="column-title" id="rightHeaderTitle">
                Step 2: Pick the exact class
              </div>
              <div class="column-subtitle" id="rightHeaderSubtitle">
                Click a course to see real dates, times, and locations.
              </div>
            </div>
          </div>
          <div class="column-body">
            <div class="panel-stack panel-stack-right mode-families" id="rightPanelStack">

              <!-- Courses list (full) -->
              <div class="stack-panel panel-courses-right">
                <div class="course-list" id="courseListFull">
                  <!-- injected course cards -->
                </div>
              </div>

              <!-- Sessions view -->
              <div class="stack-panel panel-sessions">
                <div class="sessions-shell">
                  <div class="sessions-header">
                    <div class="sessions-title" id="sessionsTitle">
                      Select a course to see all upcoming dates.
                    </div>
                    <div class="sessions-subtext" id="sessionsSubtext">
                      We‚Äôll show Wilmington, Burgaw, Jacksonville, and onsite options where available.
                    </div>
                  </div>
                  <div class="sessions-body" id="sessionsBody">
                    <!-- injected sessions -->
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </section>

      <!-- Right theme stripe with seasonal divider image -->
      <aside class="theme-stripe">
        <img id="themeDivider" src="assets/images/theme/default-divider.png" alt="Seasonal divider">
      </aside>

      <!-- Bottom-right seasonal decoration -->
      <img id="themeCorner" class="theme-corner-img"
           src="assets/images/theme/default-corner.png"
           alt="Seasonal decoration">
    </div>
  </div>

  <script>
    // ---- THEME IMAGE CONFIG ----
    // Default only; additional themes can be added later.
    const THEME_IMAGES = {
      "default": {
        logo: "assets/images/910CPR_wave.jpg",
        divider: "assets/images/theme/default-divider.png",
        corner: "assets/images/theme/default-corner.png"
      }
    };

    function applyThemeImages(themeName) {
      const cfg = THEME_IMAGES[themeName] || THEME_IMAGES["default"];

      const logoEl = document.getElementById("themeLogo");
      const dividerEl = document.getElementById("themeDivider");
      const cornerEl = document.getElementById("themeCorner");

      if (logoEl && cfg.logo) logoEl.src = cfg.logo;
      if (dividerEl && cfg.divider) dividerEl.src = cfg.divider;
      if (cornerEl && cfg.corner) cornerEl.src = cfg.corner;
    }

    // Use ACTIVE_THEME from theme-scheduler.js if available, otherwise default.
    const ACTIVE_THEME = (window.ACTIVE_THEME || "default");
    applyThemeImages(ACTIVE_THEME);

    // ---- Family definitions & images ----
    const FAMILY_DEFS = {
      "BLS": {
        key: "BLS",
        label: "BLS ‚Äì Healthcare Provider CPR",
        blurb: "Standard BLS for hospital staff, EMS, and healthcare programs.",
        image: "assets/images/family/family-bls.jpg"
      },
      "ACLS": {
        key: "ACLS",
        label: "ACLS ‚Äì Advanced Cardiac Life Support",
        blurb: "Advanced resuscitation for ER, ICU, and critical care providers.",
        image: "assets/images/family/family-acls.jpg"
      },
      "PALS": {
        key: "PALS",
        label: "PALS ‚Äì Pediatric Life Support",
        blurb: "Pediatric emergencies, respiratory failure, and cardiac arrest.",
        image: "assets/images/family/family-pals.jpg"
      },
      "CPR_AED": {
        key: "CPR_AED",
        label: "CPR/AED ‚Äì Adult & Pediatric",
        blurb: "Non-medical jobs needing CPR and AED skills without full First Aid.",
        image: "assets/images/family/family-cpr-aed.jpg"
      },
      "FA_CPR_AED": {
        key: "FA_CPR_AED",
        label: "First Aid / CPR / AED",
        blurb: "Full workplace package ‚Äì First Aid, CPR, and AED together.",
        image: "assets/images/family/family-fa-cpr-aed.jpg"
      },
      "INSTRUCTOR": {
        key: "INSTRUCTOR",
        label: "Instructor Classes",
        blurb: "Train-the-Trainer programs for future CPR & First Aid instructors.",
        image: "assets/images/910CPR_wave.jpg"
      },
      "OTHER": {
        key: "OTHER",
        label: "Other Programs & Online",
        blurb: "Specialty programs, online options, and classes that don‚Äôt fit neatly above.",
        image: "assets/images/910CPR_wave.jpg"
      }
    };

    // Determine family from course name
    function getFamilyKeyFromCourseName(name) {
      const n = (name || "").toLowerCase();

      if (n.includes("instructor")) return "INSTRUCTOR";
      if (n.includes("bls")) return "BLS";
      if (n.includes("acls")) return "ACLS";
      if (n.includes("pals") || n.includes("pediatric advanced life support")) return "PALS";

      const hasCPR = n.includes("cpr");
      const hasAED = n.includes("aed");
      const hasFirstAid = n.includes("first aid") || n.includes("first-aid");

      if (hasFirstAid && hasCPR && hasAED) return "FA_CPR_AED";
      if (hasCPR && hasAED) return "CPR_AED";

      return "OTHER";
    }

    // schedule.json -> organized structure
    function buildFamiliesFromSchedule(schedule) {
      const sessions = schedule.sessions || [];
      const byCourseId = {};

      // Group sessions by course_id, ignore non-class rows
      sessions.forEach(sess => {
        const url = sess.register_url || "";
        if (!url || !url.includes("id=")) return;

        const cid = String(sess.course_id || sess.course_name || "unknown");
        if (!byCourseId[cid]) {
          byCourseId[cid] = {
            courseId: cid,
            name: sess.course_name || ("Course " + cid),
            sessions: []
          };
        }
        byCourseId[cid].sessions.push(sess);
      });

      const familiesMap = {};
      Object.values(byCourseId).forEach(course => {
        const famKey = getFamilyKeyFromCourseName(course.name);
        if (!familiesMap[famKey]) {
          familiesMap[famKey] = [];
        }
        familiesMap[famKey].push(course);
      });

      Object.keys(familiesMap).forEach(fk => {
        familiesMap[fk].sort((a, b) => a.name.localeCompare(b.name));
      });

      const order = ["BLS", "ACLS", "PALS", "CPR_AED", "FA_CPR_AED", "INSTRUCTOR", "OTHER"];
      const familiesArray = [];
      order.forEach(fk => {
        if (familiesMap[fk] && familiesMap[fk].length) {
          familiesArray.push({
            familyKey: fk,
            courses: familiesMap[fk]
          });
        }
      });

      return familiesArray;
    }

    // ---- DOM references ----
    const familyListEl = document.getElementById("familyList");
    const courseListFullEl = document.getElementById("courseListFull");
    const courseListCompactEl = document.getElementById("courseListCompact");
    const courseListMiniStatusEl = document.getElementById("courseListMiniStatus");
    const sessionsTitleEl = document.getElementById("sessionsTitle");
    const sessionsSubtextEl = document.getElementById("sessionsSubtext");
    const sessionsBodyEl = document.getElementById("sessionsBody");
    const leftPanelStackEl = document.getElementById("leftPanelStack");
    const rightPanelStackEl = document.getElementById("rightPanelStack");
    const leftHeaderTitleEl = document.getElementById("leftHeaderTitle");
    const leftHeaderSubtitleEl = document.getElementById("leftHeaderSubtitle");
    const rightHeaderTitleEl = document.getElementById("rightHeaderTitle");
    const rightHeaderSubtitleEl = document.getElementById("rightHeaderSubtitle");
    const navBackBtn = document.getElementById("navBackBtn");

    let familiesData = [];
    let selectedFamilyKey = null;
    let selectedCourseId = null;
    let viewMode = "families"; // or "course-detail"

    function setViewMode(mode) {
      viewMode = mode;
      if (!leftPanelStackEl || !rightPanelStackEl) return;

      if (mode === "families") {
        leftPanelStackEl.classList.remove("mode-course-detail");
        leftPanelStackEl.classList.add("mode-families");
        rightPanelStackEl.classList.remove("mode-course-detail");
        rightPanelStackEl.classList.add("mode-families");

        leftHeaderTitleEl.textContent = "Step 1: Choose a class family";
        leftHeaderSubtitleEl.textContent = "We‚Äôll show only the classes that match this path.";
        rightHeaderTitleEl.textContent = "Step 2: Pick the exact class";
        rightHeaderSubtitleEl.textContent = "Click a course to see real dates, times, and locations.";
      } else {
        leftPanelStackEl.classList.remove("mode-families");
        leftPanelStackEl.classList.add("mode-course-detail");
        rightPanelStackEl.classList.remove("mode-families");
        rightPanelStackEl.classList.add("mode-course-detail");

        leftHeaderTitleEl.textContent = "Step 2: Pick your exact course";
        leftHeaderSubtitleEl.textContent = "Left: courses in this family ¬∑ Right: matching dates and locations.";
        rightHeaderTitleEl.textContent = "Step 3: Pick a date & location";
        rightHeaderSubtitleEl.textContent = "Tap Register to jump straight into Enrollware for that class.";
      }
    }

    function getFamilyData(fKey) {
      return familiesData.find(f => f.familyKey === fKey) || null;
    }

    // Render families list
    function renderFamilies() {
      if (!familyListEl) return;
      familyListEl.innerHTML = "";

      if (!familiesData.length) {
        familyListEl.innerHTML =
          '<div class="status-text">No classes were found in schedule.json. Once your snapshot builder is green again, this will populate automatically.</div>';
        return;
      }

      familiesData.forEach(fam => {
        const def = FAMILY_DEFS[fam.familyKey] || FAMILY_DEFS["OTHER"];

        const card = document.createElement("div");
        card.className = "family-card";
        if (fam.familyKey === selectedFamilyKey) {
          card.classList.add("active");
        }

        const imgWrap = document.createElement("div");
        imgWrap.className = "family-image";
        const img = document.createElement("img");
        img.src = def.image;
        img.alt = def.label;
        imgWrap.appendChild(img);

        const textWrap = document.createElement("div");
        const main = document.createElement("div");
        main.className = "family-text-main";
        main.textContent = def.label;
        const sub = document.createElement("div");
        sub.className = "family-text-sub";
        sub.textContent = def.blurb;

        textWrap.appendChild(main);
        textWrap.appendChild(sub);

        card.appendChild(imgWrap);
        card.appendChild(textWrap);

        card.addEventListener("click", () => {
          selectedFamilyKey = fam.familyKey;
          selectedCourseId = null;
          setViewMode("families");
          renderFamilies();
          renderCoursesForFamily(fam.familyKey);
          renderCompactCoursesForFamily(fam.familyKey);
          renderSessionsForCourse(null);
        });

        familyListEl.appendChild(card);
      });
    }

    // Render full course cards (right column, families mode)
    function renderCoursesForFamily(fKey) {
      if (!courseListFullEl) return;
      courseListFullEl.innerHTML = "";

      const fam = getFamilyData(fKey);
      if (!fam) {
        courseListFullEl.innerHTML =
          '<div class="status-text">No courses found for this family. Try another family on the left.</div>';
        return;
      }

      fam.courses.forEach(course => {
        const card = document.createElement("div");
        card.className = "course-card";
        if (course.courseId === selectedCourseId) {
          card.classList.add("selected");
        }

        const title = document.createElement("div");
        title.className = "course-title-main";
        title.textContent = course.name;

        const metaRow = document.createElement("div");
        metaRow.className = "course-meta-row";

        const chip = document.createElement("div");
        chip.className = "course-chip";
        const sessionCount = (course.sessions || []).length;
        chip.textContent = sessionCount > 0
          ? (sessionCount + " session" + (sessionCount !== 1 ? "s" : ""))
          : "Dates vary";

        const sub = document.createElement("div");
        sub.className = "course-subtext";
        sub.textContent = "Shows Wilmington, Burgaw, Jacksonville & onsite when available.";

        metaRow.appendChild(chip);
        metaRow.appendChild(sub);

        const footRow = document.createElement("div");
        footRow.className = "course-foot-row";
        const notes = document.createElement("div");
        notes.textContent = "Click to see all dates & locations.";
        const arrow = document.createElement("div");
        arrow.textContent = "‚Ä∫";
        arrow.style.fontWeight = "600";
        footRow.appendChild(notes);
        footRow.appendChild(arrow);

        card.appendChild(title);
        card.appendChild(metaRow);
        card.appendChild(footRow);

        card.addEventListener("click", () => {
          selectedFamilyKey = fKey;
          selectedCourseId = course.courseId;
          setViewMode("course-detail");
          renderFamilies();
          renderCompactCoursesForFamily(fKey);
          renderCoursesForFamily(fKey);
          renderSessionsForCourse(course.courseId);
        });

        courseListFullEl.appendChild(card);
      });
    }

    // Render compact courses (left column in course-detail mode)
    function renderCompactCoursesForFamily(fKey) {
      if (!courseListCompactEl) return;
      courseListCompactEl.innerHTML = "";

      const fam = getFamilyData(fKey);
      if (!fam) {
        courseListCompactEl.innerHTML =
          '<div class="status-text">No courses for this family.</div>';
        return;
      }

      if (courseListMiniStatusEl) {
        courseListMiniStatusEl.textContent =
          "Courses in " + (FAMILY_DEFS[fKey]?.label || "this family") + ".";
      }

      fam.courses.forEach(course => {
        const pill = document.createElement("div");
        pill.className = "course-pill";
        if (course.courseId === selectedCourseId) {
          pill.classList.add("selected");
        }

        const labelSpan = document.createElement("span");
        labelSpan.className = "label";
        labelSpan.textContent = course.name;

        const countSpan = document.createElement("span");
        countSpan.className = "count";
        const count = (course.sessions || []).length;
        countSpan.textContent = count > 0 ? (count + "√ó") : "‚Äì";

        pill.appendChild(labelSpan);
        pill.appendChild(countSpan);

        pill.addEventListener("click", () => {
          selectedCourseId = course.courseId;
          setViewMode("course-detail");
          renderCompactCoursesForFamily(fKey);
          renderCoursesForFamily(fKey);
          renderSessionsForCourse(course.courseId);
        });

        courseListCompactEl.appendChild(pill);
      });
    }

    // Render sessions for a course (right column in course-detail mode)
    function renderSessionsForCourse(courseId) {
      if (!sessionsBodyEl) return;

      if (!courseId) {
        sessionsTitleEl.textContent = "Select a course to see all upcoming dates.";
        sessionsSubtextEl.textContent =
          "We‚Äôll show Wilmington, Burgaw, Jacksonville, and onsite options where available.";
        sessionsBodyEl.innerHTML =
          '<div class="no-sessions">Once you choose a course on the right, all future class times will show here with direct Register buttons.</div>';
        return;
      }

      const family = getFamilyData(selectedFamilyKey);
      if (!family) return;
      const course = family.courses.find(c => c.courseId === courseId);
      if (!course) return;

      sessionsTitleEl.textContent = course.name;
      sessionsSubtextEl.textContent =
        "Pick the time and location that works best. We‚Äôll send you straight to Enrollware for this class.";

      const sessions = course.sessions || [];
      sessionsBodyEl.innerHTML = "";

      if (!sessions.length) {
        sessionsBodyEl.innerHTML =
          '<div class="no-sessions">No live dates are scheduled yet for this course. Call or text (910) 395-5193 and we‚Äôll help you plan the next session.</div>';
        return;
      }

      sessions.forEach(sess => {
        const card = document.createElement("div");
        card.className = "session-card";

        const mainRow = document.createElement("div");
        mainRow.className = "session-main-row";

        const dateDiv = document.createElement("div");
        dateDiv.className = "session-date";
        const start = sess.start_display || "";
        const parts = start.split(" at ");
        const dateLabel = parts[0] || start;
        const timeLabel = parts[1] || "";
        dateDiv.textContent = dateLabel;

        const timeDiv = document.createElement("div");
        timeDiv.textContent = timeLabel;

        mainRow.appendChild(dateDiv);
        mainRow.appendChild(timeDiv);

        const locDiv = document.createElement("div");
        locDiv.className = "session-location";
        locDiv.textContent = sess.location_short || sess.location || "";

        const footRow = document.createElement("div");
        footRow.className = "session-foot-row";

        const priceDiv = document.createElement("div");
        priceDiv.className = "session-price";
        priceDiv.textContent = ""; // price not available in schedule.json yet

        const btn = document.createElement("button");
        btn.type = "button";
        btn.className = "session-btn";
        btn.innerHTML = '<span>Register</span> <span>‚ü∂</span>';
        const url = sess.register_url || "";
        btn.addEventListener("click", () => {
          if (url) {
            window.location.href = url;
          }
        });

        footRow.appendChild(priceDiv);
        footRow.appendChild(btn);

        card.appendChild(mainRow);
        card.appendChild(locDiv);
        card.appendChild(footRow);

        sessionsBodyEl.appendChild(card);
      });
    }

    // Back button:
    if (navBackBtn) {
      navBackBtn.addEventListener("click", () => {
        if (viewMode === "course-detail") {
          setViewMode("families");
          selectedCourseId = null;
          renderCompactCoursesForFamily(selectedFamilyKey);
          renderCoursesForFamily(selectedFamilyKey);
          renderSessionsForCourse(null);
        } else {
          window.location.href = "https://910cpr.com";
        }
      });
    }

    // Initialize from schedule.json
    async function initSchedule() {
      try {
        const resp = await fetch("data/schedule.json", { cache: "no-store" });
        if (!resp.ok) throw new Error("HTTP " + resp.status);
        const schedule = await resp.json();
        familiesData = buildFamiliesFromSchedule(schedule);
      } catch (err) {
        console.error("Failed to load schedule.json; page will be mostly empty:", err);
        familiesData = [];
      }

      if (familiesData.length) {
        selectedFamilyKey = familiesData[0].familyKey;
      }

      renderFamilies();
      if (selectedFamilyKey) {
        renderCoursesForFamily(selectedFamilyKey);
        renderCompactCoursesForFamily(selectedFamilyKey);
      }
      renderSessionsForCourse(null);
      setViewMode("families");
    }

    initSchedule();
  </script>
</body>
</html>