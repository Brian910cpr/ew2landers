<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>910CPR ‚Äì Mobile Class Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    :root {
      --bg-page: #0b1120;
      --bg-shell: #020617;
      --bg-card: #0f172a;
      --bg-card-soft: #111827;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --accent-main: #38bdf8;
      --accent-soft: rgba(56, 189, 248, 0.12);
      --accent-strong: #0ea5e9;
      --border-subtle: #1f2937;
      --radius-lg: 18px;
      --radius-md: 14px;
      --shadow-soft: 0 16px 40px rgba(0, 0, 0, 0.65);
      --transition-fast: 0.25s ease;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b, #020617 58%, #000 100%);
      color: var(--text-main);
      -webkit-font-smoothing: antialiased;
      font-size: clamp(14px, 3.7vw, 17px);
    }

    a { color: inherit; text-decoration: none; }

    /* Top app bar */
    .app-bar {
      height: 62px;
      padding: 10px 14px 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #0ea5e9, #1e293b 55%, #020617 100%);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.9);
      position: sticky;
      top: 0;
      z-index: 20;
    }

    .app-left {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .app-logo-wrap {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      padding: 3px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(226, 232, 240, 0.7);
      overflow: hidden;
      flex-shrink: 0;
    }

    .app-logo-wrap img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
    }

    .app-title {
      display: flex;
      flex-direction: column;
      gap: 1px;
    }

    .app-title-main {
      font-size: clamp(13px, 3.4vw, 16px);
      font-weight: 600;
      line-height: 1.1;
    }

    .app-title-sub {
      font-size: clamp(10px, 2.6vw, 12px);
      color: #e5e7eb;
      opacity: 0.9;
    }

    .app-right {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .small-pill {
      font-size: clamp(9px, 2.4vw, 11px);
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(226, 232, 240, 0.6);
      background: rgba(15, 23, 42, 0.65);
      color: #e5e7eb;
    }

    .link-btn {
      font-size: clamp(10px, 2.7vw, 12px);
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.85);
      color: #e5e7eb;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .link-btn span.icon {
      font-size: 14px;
    }

    /* App shell */
    .app-shell {
      padding: 10px 10px 14px;
    }

    .app-card {
      border-radius: 22px;
      background: radial-gradient(circle at top, #1f2937, #020617 65%);
      padding: 10px;
      box-shadow: var(--shadow-soft);
      min-height: calc(100vh - 86px);
      position: relative;
      overflow: hidden;
    }

    .app-card-header {
      padding: 2px 4px 8px;
      font-size: clamp(11px, 2.8vw, 13px);
      color: var(--text-muted);
      text-align: center;
    }

    /* Views slider */
    .views {
      display: flex;
      width: 300%;
      transition: transform var(--transition-fast);
    }

    .view {
      width: 100%;
      padding: 6px 2px 8px;
    }

    .view h2 {
      margin: 0 6px 8px;
      font-size: clamp(15px, 4.1vw, 18px);
      font-weight: 600;
    }

    .view-subtitle {
      margin: 0 6px 10px;
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
    }

    /* Family cards */
    .family-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 4px 10px;
    }

    .family-card {
      display: flex;
      gap: 10px;
      align-items: center;
      padding: 8px 9px;
      border-radius: var(--radius-md);
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.7);
      cursor: pointer;
      transition: background var(--transition-fast), transform 0.14s ease-out, box-shadow var(--transition-fast), border-color var(--transition-fast);
    }

    .family-card:hover {
      background: #111827;
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.9);
    }

    .family-card.active {
      border-color: var(--accent-main);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(56, 189, 248, 0.08));
      box-shadow: 0 12px 26px rgba(8, 47, 73, 0.9);
    }

    .family-img {
      width: 54px;
      height: 54px;
      border-radius: 16px;
      overflow: hidden;
      flex-shrink: 0;
      background: #1e293b;
    }

    .family-img img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .family-text {
      flex: 1;
      min-width: 0;
    }

    .family-name {
      font-size: clamp(13px, 3.6vw, 16px);
      font-weight: 600;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .family-blurb {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .family-meta-row {
      font-size: clamp(10px, 2.6vw, 12px);
      display: flex;
      gap: 10px;
      color: var(--text-muted);
    }

    /* Course list */
    .back-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0 6px 10px;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.85);
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      font-size: 18px;
      cursor: pointer;
    }

    .back-label {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
    }

    .course-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 4px 10px;
    }

    .course-card {
      border-radius: var(--radius-md);
      background: var(--bg-card-soft);
      border: 1px solid var(--border-subtle);
      padding: 8px 9px 7px;
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.8);
      cursor: pointer;
      transition: background var(--transition-fast), box-shadow var(--transition-fast), transform 0.14s ease-out, border-color var(--transition-fast);
    }

    .course-card:hover {
      background: #111827;
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.9);
    }

    .course-card.selected {
      border-color: var(--accent-main);
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(56, 189, 248, 0.06));
      box-shadow: 0 14px 32px rgba(8, 47, 73, 0.9);
    }

    .course-title {
      font-size: clamp(13px, 3.6vw, 16px);
      font-weight: 600;
      margin-bottom: 4px;
    }

    .course-subtext {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
      margin-bottom: 5px;
    }

    .course-meta-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: clamp(10px, 2.6vw, 12px);
      color: var(--text-muted);
    }

    .pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent-main);
      font-weight: 500;
    }

    /* Sessions */
    .sessions-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 0 4px 10px;
    }

    .session-card {
      border-radius: var(--radius-md);
      background: var(--bg-card-soft);
      border: 1px solid var(--border-subtle);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.9);
      padding: 8px 9px 7px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .session-main-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      font-size: clamp(12px, 3.2vw, 14px);
    }

    .session-date {
      font-weight: 600;
    }

    .session-time {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
    }

    .session-location {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
    }

    .session-foot {
      margin-top: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .session-price {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
      font-style: italic;
    }

    .session-btn {
      border: 0;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: clamp(12px, 3.3vw, 14px);
      font-weight: 600;
      color: #f9fafb;
      background: linear-gradient(135deg, #0ea5e9, #22c55e);
      box-shadow: 0 10px 26px rgba(8, 47, 73, 0.9);
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
    }

    .session-btn:active {
      transform: translateY(1px);
      box-shadow: 0 5px 14px rgba(8, 47, 73, 0.9);
    }

    .status-text {
      font-size: clamp(11px, 2.9vw, 13px);
      color: var(--text-muted);
      margin: 8px 8px 12px;
      text-align: center;
    }

    /* Bottom decoration */
    .bottom-decoration {
      position: absolute;
      right: -12px;
      bottom: -6px;
      width: 120px;
      opacity: 0.22;
      pointer-events: none;
    }
  </style>
</head>
<body>

<header class="app-bar">
  <div class="app-left">
    <div class="app-logo-wrap">
      <img id="themeLogo" src="assets/images/910CPR_wave.jpg" alt="910CPR logo">
    </div>
    <div class="app-title">
      <div class="app-title-main">910CPR ‚Äì Live Classes</div>
      <div class="app-title-sub">Tap your class type ¬∑ then date ¬∑ then register</div>
    </div>
  </div>
  <div class="app-right">
    <div class="small-pill">Wilmington ¬∑ Burgaw ¬∑ Jacksonville</div>
    <a href="index.html" class="link-btn">
      <span class="icon">üñ•Ô∏è</span>
      <span>Desktop version</span>
    </a>
  </div>
</header>

<main class="app-shell">
  <section class="app-card">
    <div class="app-card-header">
      What kind of CPR or First Aid do you need? Start with your <strong>family</strong> of classes.
    </div>

    <div class="views" id="views">
      <!-- View 0: Families -->
      <section class="view" data-view="families">
        <h2>Step 1 ¬∑ Choose a class family</h2>
        <p class="view-subtitle">Healthcare, ACLS, PALS, Heartsaver, First Aid, instructors, and more.</p>
        <div id="familyList" class="family-list"></div>
      </section>

      <!-- View 1: Courses -->
      <section class="view" data-view="courses">
        <div class="back-row">
          <button class="back-button" id="backToFamilies">‚Äπ</button>
          <div class="back-label" id="familyBackLabel">Change class family</div>
        </div>
        <h2 id="coursesTitle">Step 2 ¬∑ Pick the exact course</h2>
        <p class="view-subtitle" id="coursesSubtitle">
          These are all the ways we teach that family ‚Äì pick the one your job or school needs.
        </p>
        <div id="courseList" class="course-list"></div>
      </section>

      <!-- View 2: Sessions -->
      <section class="view" data-view="sessions">
        <div class="back-row">
          <button class="back-button" id="backToCourses">‚Äπ</button>
          <div class="back-label" id="courseBackLabel">Back to course list</div>
        </div>
        <h2 id="sessionsTitle">Step 3 ¬∑ Pick a date &amp; location</h2>
        <p class="view-subtitle" id="sessionsSubtitle">
          We‚Äôll show Wilmington, Burgaw, Jacksonville, and onsite classes where available.
        </p>
        <div id="sessionsList" class="sessions-list"></div>
      </section>
    </div>

    <img src="assets/images/910CPR_wave.jpg" alt="" class="bottom-decoration">
  </section>
</main>

<script>
  // --------- FAMILY DEFINITIONS & HELPERS ---------

  const FAMILY_DEFS = {
    "BLS": {
      key: "BLS",
      label: "BLS ‚Äì Healthcare Provider CPR",
      blurb: "Hospital staff, EMS, and healthcare providers who need Basic Life Support.",
      image: "assets/images/family/family-bls.jpg"
    },
    "ACLS": {
      key: "ACLS",
      label: "ACLS ‚Äì Advanced Cardiac Life Support",
      blurb: "Advanced cardiac resuscitation for ER, ICU, and critical-care providers.",
      image: "assets/images/family/family-acls.jpg"
    },
    "PALS": {
      key: "PALS",
      label: "PALS ‚Äì Pediatric Life Support",
      blurb: "Pediatric respiratory and cardiac emergencies.",
      image: "assets/images/family/family-pals.jpg"
    },
    "CPR_AED": {
      key: "CPR_AED",
      label: "CPR/AED ‚Äì Adult & Pediatric",
      blurb: "Jobs that require CPR and AED but not full First Aid.",
      image: "assets/images/family/family-cpr-aed.jpg"
    },
    "FA_CPR_AED": {
      key: "FA_CPR_AED",
      label: "First Aid / CPR / AED",
      blurb: "Full workplace package: First Aid, CPR, and AED together.",
      image: "assets/images/family/family-fa-cpr-aed.jpg"
    },
    "INSTRUCTOR": {
      key: "INSTRUCTOR",
      label: "Instructor Courses",
      blurb: "Train-the-trainer classes for new instructors.",
      image: "assets/images/910CPR_wave.jpg"
    },
    "OTHER": {
      key: "OTHER",
      label: "Other & Online Programs",
      blurb: "Online and specialty options that don‚Äôt fit above.",
      image: "assets/images/910CPR_wave.jpg"
    }
  };

  function getFamilyKeyFromCourseName(name) {
    const n = (name || "").toLowerCase();

    if (n.includes("instructor")) return "INSTRUCTOR";
    if (n.includes("bls")) return "BLS";
    if (n.includes("acls")) return "ACLS";
    if (n.includes("pals") || n.includes("pediatric advanced life support")) return "PALS";

    const hasCPR = n.includes("cpr");
    const hasAED = n.includes("aed");
    const hasFirstAid = n.includes("first aid") || n.includes("first-aid");

    if (hasFirstAid && hasCPR && hasAED) return "FA_CPR_AED";
    if (hasCPR && hasAED) return "CPR_AED";

    return "OTHER";
  }

  function buildFamiliesFromSchedule(schedule) {
    const sessions = schedule.sessions || [];
    const byCourseId = {};

    sessions.forEach(sess => {
      const url = sess.register_url || "";
      if (!url || !url.includes("id=")) return; // ignore non-registerable rows

      const cid = String(sess.course_id || sess.course_name || "unknown");
      if (!byCourseId[cid]) {
        byCourseId[cid] = {
          courseId: cid,
          name: sess.course_name || ("Course " + cid),
          sessions: []
        };
      }
      byCourseId[cid].sessions.push(sess);
    });

    const familiesMap = {};
    Object.values(byCourseId).forEach(course => {
      const famKey = getFamilyKeyFromCourseName(course.name);
      if (!familiesMap[famKey]) familiesMap[famKey] = [];
      familiesMap[famKey].push(course);
    });

    Object.keys(familiesMap).forEach(fk => {
      familiesMap[fk].sort((a, b) => a.name.localeCompare(b.name));
    });

    const order = ["BLS", "ACLS", "PALS", "CPR_AED", "FA_CPR_AED", "INSTRUCTOR", "OTHER"];
    const families = [];
    order.forEach(fk => {
      if (familiesMap[fk] && familiesMap[fk].length) {
        families.push({
          familyKey: fk,
          courses: familiesMap[fk]
        });
      }
    });
    return families;
  }

  // --------- STATE ---------

  const viewsEl = document.getElementById("views");
  const familyListEl = document.getElementById("familyList");
  const courseListEl = document.getElementById("courseList");
  const sessionsListEl = document.getElementById("sessionsList");

  const backToFamiliesBtn = document.getElementById("backToFamilies");
  const backToCoursesBtn = document.getElementById("backToCourses");
  const familyBackLabel = document.getElementById("familyBackLabel");
  const courseBackLabel = document.getElementById("courseBackLabel");
  const coursesTitleEl = document.getElementById("coursesTitle");
  const coursesSubtitleEl = document.getElementById("coursesSubtitle");
  const sessionsTitleEl = document.getElementById("sessionsTitle");
  const sessionsSubtitleEl = document.getElementById("sessionsSubtitle");

  let familiesData = [];
  let selectedFamilyKey = null;
  let selectedCourseId = null;
  let currentView = 0; // 0=families, 1=courses, 2=sessions

  function goToView(index) {
    currentView = index;
    if (!viewsEl) return;
    viewsEl.style.transform = "translateX(-" + (index * 100) + "%)";
  }

  function getFamilyData(fKey) {
    return familiesData.find(f => f.familyKey === fKey) || null;
  }

  // --------- RENDERERS ---------

  function renderFamilies() {
    if (!familyListEl) return;
    familyListEl.innerHTML = "";

    if (!familiesData.length) {
      familyListEl.innerHTML =
        '<div class="status-text">No classes in schedule.json yet. Once your snapshot workflow is green, this mobile view will auto-fill.</div>';
      return;
    }

    familiesData.forEach(fam => {
      const def = FAMILY_DEFS[fam.familyKey] || FAMILY_DEFS["OTHER"];
      const totalCourses = fam.courses.length;
      const totalSessions = fam.courses.reduce((sum, c) => sum + (c.sessions || []).length, 0);

      const card = document.createElement("div");
      card.className = "family-card";
      if (fam.familyKey === selectedFamilyKey) card.classList.add("active");

      const imgWrap = document.createElement("div");
      imgWrap.className = "family-img";
      const img = document.createElement("img");
      img.src = def.image;
      img.alt = def.label;
      imgWrap.appendChild(img);

      const textWrap = document.createElement("div");
      textWrap.className = "family-text";

      const nameDiv = document.createElement("div");
      nameDiv.className = "family-name";
      nameDiv.textContent = def.label;

      const blurbDiv = document.createElement("div");
      blurbDiv.className = "family-blurb";
      blurbDiv.textContent = def.blurb;

      const metaRow = document.createElement("div");
      metaRow.className = "family-meta-row";
      metaRow.innerHTML =
        `<span>${totalCourses} course${totalCourses !== 1 ? "s" : ""}</span>` +
        `<span>${totalSessions} upcoming class${totalSessions !== 1 ? "es" : ""}</span>`;

      textWrap.appendChild(nameDiv);
      textWrap.appendChild(blurbDiv);
      textWrap.appendChild(metaRow);

      card.appendChild(imgWrap);
      card.appendChild(textWrap);

      card.addEventListener("click", () => {
        selectedFamilyKey = fam.familyKey;
        selectedCourseId = null;
        renderFamilies();
        renderCoursesForFamily(fam.familyKey);
        goToView(1);
      });

      familyListEl.appendChild(card);
    });
  }

  function renderCoursesForFamily(fKey) {
    if (!courseListEl) return;
    courseListEl.innerHTML = "";

    const fam = getFamilyData(fKey);
    const def = FAMILY_DEFS[fKey] || FAMILY_DEFS["OTHER"];

    if (familyBackLabel) {
      familyBackLabel.textContent = "Back ‚Äì pick a different class family";
    }
    if (coursesTitleEl) {
      coursesTitleEl.textContent = def.label;
    }
    if (coursesSubtitleEl) {
      coursesSubtitleEl.textContent = def.blurb;
    }

    if (!fam) {
      courseListEl.innerHTML =
        '<div class="status-text">No courses for this family yet. Try another family.</div>';
      return;
    }

    fam.courses.forEach(course => {
      const card = document.createElement("div");
      card.className = "course-card";
      if (course.courseId === selectedCourseId) card.classList.add("selected");

      const titleDiv = document.createElement("div");
      titleDiv.className = "course-title";
      titleDiv.textContent = course.name;

      const subDiv = document.createElement("div");
      subDiv.className = "course-subtext";
      subDiv.textContent = "Tap to see every upcoming date and location for this course.";

      const metaRow = document.createElement("div");
      metaRow.className = "course-meta-row";
      const count = (course.sessions || []).length;

      const pill = document.createElement("span");
      pill.className = "pill";
      pill.textContent = count > 0
        ? `${count} live session${count !== 1 ? "s" : ""}`
        : "Dates vary";

      const hint = document.createElement("span");
      hint.textContent = "‚Ä∫";

      metaRow.appendChild(pill);
      metaRow.appendChild(hint);

      card.appendChild(titleDiv);
      card.appendChild(subDiv);
      card.appendChild(metaRow);

      card.addEventListener("click", () => {
        selectedCourseId = course.courseId;
        renderCoursesForFamily(fKey);
        renderSessionsForCourse(course.courseId);
        goToView(2);
      });

      courseListEl.appendChild(card);
    });
  }

  function renderSessionsForCourse(courseId) {
    if (!sessionsListEl) return;
    sessionsListEl.innerHTML = "";

    const fam = getFamilyData(selectedFamilyKey);
    if (!fam) return;
    const course = fam.courses.find(c => c.courseId === courseId);
    if (!course) return;

    if (courseBackLabel) {
      courseBackLabel.textContent = "Back ‚Äì pick a different course in this family";
    }
    if (sessionsTitleEl) {
      sessionsTitleEl.textContent = course.name;
    }
    if (sessionsSubtitleEl) {
      sessionsSubtitleEl.textContent = "Pick a time and location, then tap Register to jump into Enrollware.";
    }

    const sessions = course.sessions || [];
    if (!sessions.length) {
      sessionsListEl.innerHTML =
        '<div class="status-text">No live dates are scheduled yet. Call or text (910) 395-5193 and we can plan the next class for you.</div>';
      return;
    }

    sessions.forEach(sess => {
      const card = document.createElement("div");
      card.className = "session-card";

      const mainRow = document.createElement("div");
      mainRow.className = "session-main-row";

      const dateDiv = document.createElement("div");
      dateDiv.className = "session-date";

      const start = sess.start_display || "";
      const parts = start.split(" at ");
      const dateLabel = parts[0] || start;
      const timeLabel = parts[1] || "";

      dateDiv.textContent = dateLabel;

      const timeDiv = document.createElement("div");
      timeDiv.className = "session-time";
      timeDiv.textContent = timeLabel;

      mainRow.appendChild(dateDiv);
      mainRow.appendChild(timeDiv);

      const locDiv = document.createElement("div");
      locDiv.className = "session-location";
      locDiv.textContent = sess.location_short || sess.location || "";

      const foot = document.createElement("div");
      foot.className = "session-foot";

      const priceDiv = document.createElement("div");
      priceDiv.className = "session-price";
      priceDiv.textContent = ""; // no price in schedule.json yet

      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "session-btn";
      btn.innerHTML = '<span>Register</span> <span>‚ü∂</span>';
      const url = sess.register_url || "";
      btn.addEventListener("click", () => {
        if (url) window.location.href = url;
      });

      foot.appendChild(priceDiv);
      foot.appendChild(btn);

      card.appendChild(mainRow);
      card.appendChild(locDiv);
      card.appendChild(foot);

      sessionsListEl.appendChild(card);
    });
  }

  // --------- NAV HANDLERS ---------

  if (backToFamiliesBtn) {
    backToFamiliesBtn.addEventListener("click", () => {
      goToView(0);
    });
  }

  if (backToCoursesBtn) {
    backToCoursesBtn.addEventListener("click", () => {
      goToView(1);
    });
  }

  // --------- INIT ---------

  async function initMobileSchedule() {
    try {
      const resp = await fetch("data/schedule.json", { cache: "no-store" });
      if (!resp.ok) throw new Error("HTTP " + resp.status);
      const schedule = await resp.json();
      familiesData = buildFamiliesFromSchedule(schedule);
    } catch (err) {
      console.error("Failed to load schedule.json for mobile:", err);
      familiesData = [];
    }

    if (familiesData.length) {
      selectedFamilyKey = familiesData[0].familyKey;
    }

    renderFamilies();
    goToView(0);
  }

  initMobileSchedule();
</script>

</body>
</html>
